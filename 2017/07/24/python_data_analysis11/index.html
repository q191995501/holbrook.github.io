<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="读书笔记,python," />





  <link rel="alternate" href="/atom.xml" title="心内求法" type="application/atom+xml" />






<meta name="description" content="《利用Python进行数据分析》读书笔记。第 11 章：金融和经济数据应用 自2005年开始，python在金融行业中的应用越来越多。 这主要得益于越来越成熟的函数库（NumPy和pandas）以及大量经验丰富的程序员。 许多机构发现python不仅非常适合成为交互式的分析环境，也非常适合开发文件的系统，所需的时间也比Java或C++少得多。 Python还是一种非常好的粘合层，可以非常轻松为C或">
<meta name="keywords" content="读书笔记,python">
<meta property="og:type" content="article">
<meta property="og:title" content="利用Python进行数据分析(11)：金融和经济数据应用">
<meta property="og:url" content="http://holbrook.github.io/2017/07/24/python_data_analysis11/index.html">
<meta property="og:site_name" content="心内求法">
<meta property="og:description" content="《利用Python进行数据分析》读书笔记。第 11 章：金融和经济数据应用 自2005年开始，python在金融行业中的应用越来越多。 这主要得益于越来越成熟的函数库（NumPy和pandas）以及大量经验丰富的程序员。 许多机构发现python不仅非常适合成为交互式的分析环境，也非常适合开发文件的系统，所需的时间也比Java或C++少得多。 Python还是一种非常好的粘合层，可以非常轻松为C或">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="data:image/png;base64,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
">
<meta property="og:updated_time" content="2017-10-30T06:12:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="利用Python进行数据分析(11)：金融和经济数据应用">
<meta name="twitter:description" content="《利用Python进行数据分析》读书笔记。第 11 章：金融和经济数据应用 自2005年开始，python在金融行业中的应用越来越多。 这主要得益于越来越成熟的函数库（NumPy和pandas）以及大量经验丰富的程序员。 许多机构发现python不仅非常适合成为交互式的分析环境，也非常适合开发文件的系统，所需的时间也比Java或C++少得多。 Python还是一种非常好的粘合层，可以非常轻松为C或">
<meta name="twitter:image" content="data:image/png;base64,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
">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '2D390ZMGCJ',
      apiKey: '98fe25d384567f4447d37429b35a233e',
      indexName: 'thinkinside',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://holbrook.github.io/2017/07/24/python_data_analysis11/"/>





  <title>利用Python进行数据分析(11)：金融和经济数据应用 | 心内求法</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?16d951e9b49ded5f2e821a0e61d77797";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">心内求法</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Holbrook的个人博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://holbrook.github.io/2017/07/24/python_data_analysis11/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Holbrook">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心内求法">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">利用Python进行数据分析(11)：金融和经济数据应用</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-24T00:00:00+08:00">
                2017-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据分析/" itemprop="url" rel="index">
                    <span itemprop="name">数据分析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/07/24/python_data_analysis11/index.html" class="leancloud_visitors" data-flag-title="利用Python进行数据分析(11)：金融和经济数据应用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>《<a href="https://book.douban.com/subject/25779298/" target="_blank" rel="external">利用Python进行数据分析</a>》读书笔记。<br>第 11 章：金融和经济数据应用</p>
<p>自2005年开始，python在金融行业中的应用越来越多。</p>
<p>这主要得益于越来越成熟的函数库（NumPy和pandas）以及大量经验丰富的程序员。</p>
<p>许多机构发现python不仅非常适合成为交互式的分析环境，也非常适合开发文件的系统，所需的时间也比Java或C++少得多。</p>
<p>Python还是一种非常好的粘合层，可以非常轻松为C或C++编写的库构建Python接口。</p>
<p>金融分析领域的内容博大精深。在数据规整化方面所花费的精力常常会比解决核心建模和研究问题所花费的时间多得多。</p>
<p>在本章中，术语截面（cross-section）来表示某个时间点的数据。</p>
<p>例如标普500指数中所有成份股在特定日期的收盘价就形成了一个截面。</p>
<p>多个数据在多个时间点的截面数据就构成了一个面板（panel）。</p>
<p>面板数据既可以表示为层次化索引的DataFrame，也可以表示为三维的Panel pandas对象。</p>
<a id="more"></a>
<h1 id="数据规整化方面的话题"><a href="#数据规整化方面的话题" class="headerlink" title="数据规整化方面的话题"></a>数据规整化方面的话题</h1><a href="/2017/07/24/python_data_analysis11/index.html/python_data_analysis11-1.ipynb" title="下载ipynb">下载ipynb</a>

<div class="notebook-border">
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div id="notebook-container">
      
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>《<a href="https://book.douban.com/subject/25779298/" target="_blank" rel="external">利用Python进行数据分析</a>》读书笔记。</p>
<p><a href="/2017/07/24/python_data_analysis11.html">第11章</a>  第1节：数据规整化方面的话题</p>
<p>所有用到的数据可以从<a href="https://github.com/wesm/pydata-book" target="_blank" rel="external">作者的 github</a>下载。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Populating the interactive namespace from numpy and matplotlib
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>数据规整：Data munging</p>
<h2 id="&#26102;&#38388;&#24207;&#21015;&#20197;&#21450;&#25130;&#38754;&#23545;&#40784;">&#26102;&#38388;&#24207;&#21015;&#20197;&#21450;&#25130;&#38754;&#23545;&#40784;<a class="anchor-link" href="#&#26102;&#38388;&#24207;&#21015;&#20197;&#21450;&#25130;&#38754;&#23545;&#40784;">&#182;</a></h2><p>处理金融数据时，最费神的一个问题就是所谓的数据对齐（data alignment）。</p>
<p>两个时间序列的索引可能没有很好的对齐，或者两个DataFrame对象可能含有不匹配的行或者列。</p>
<p>MATLAB、R用户通常会耗费大量的时间来进行数据对对齐工作。</p>
<p>pandas可以在运算中自动对齐数据。这是极好的，会提高效率。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">close_px</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/ch11/stock_px.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/ch11/volume.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">prices</span> <span class="o">=</span> <span class="n">close_px</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s1">&#39;2011-09-05&#39;</span><span class="p">:</span><span class="s1">&#39;2011-09-14&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;JNJ&#39;</span><span class="p">,</span> <span class="s1">&#39;SPX&#39;</span><span class="p">,</span> <span class="s1">&#39;XOM&#39;</span><span class="p">]]</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s1">&#39;2011-09-05&#39;</span><span class="p">:</span><span class="s1">&#39;2011-09-12&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;JNJ&#39;</span><span class="p">,</span> <span class="s1">&#39;XOM&#39;</span><span class="p">]]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prices</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[6]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AAPL</th>
      <th>JNJ</th>
      <th>SPX</th>
      <th>XOM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-09-06</th>
      <td>379.74</td>
      <td>64.64</td>
      <td>1165.24</td>
      <td>71.15</td>
    </tr>
    <tr>
      <th>2011-09-07</th>
      <td>383.93</td>
      <td>65.43</td>
      <td>1198.62</td>
      <td>73.65</td>
    </tr>
    <tr>
      <th>2011-09-08</th>
      <td>384.14</td>
      <td>64.95</td>
      <td>1185.90</td>
      <td>72.82</td>
    </tr>
    <tr>
      <th>2011-09-09</th>
      <td>377.48</td>
      <td>63.64</td>
      <td>1154.23</td>
      <td>71.01</td>
    </tr>
    <tr>
      <th>2011-09-12</th>
      <td>379.94</td>
      <td>63.59</td>
      <td>1162.27</td>
      <td>71.84</td>
    </tr>
    <tr>
      <th>2011-09-13</th>
      <td>384.62</td>
      <td>63.61</td>
      <td>1172.87</td>
      <td>71.65</td>
    </tr>
    <tr>
      <th>2011-09-14</th>
      <td>389.30</td>
      <td>63.73</td>
      <td>1188.68</td>
      <td>72.64</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">volume</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AAPL</th>
      <th>JNJ</th>
      <th>XOM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-09-06</th>
      <td>18173500.0</td>
      <td>15848300.0</td>
      <td>25416300.0</td>
    </tr>
    <tr>
      <th>2011-09-07</th>
      <td>12492000.0</td>
      <td>10759700.0</td>
      <td>23108400.0</td>
    </tr>
    <tr>
      <th>2011-09-08</th>
      <td>14839800.0</td>
      <td>15551500.0</td>
      <td>22434800.0</td>
    </tr>
    <tr>
      <th>2011-09-09</th>
      <td>20171900.0</td>
      <td>17008200.0</td>
      <td>27969100.0</td>
    </tr>
    <tr>
      <th>2011-09-12</th>
      <td>16697300.0</td>
      <td>13448200.0</td>
      <td>26205800.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 如果想计算一个基于成交量的加权平均价</span>
<span class="c1"># pandas在算术运算时会自动对齐数据</span>
<span class="c1"># sum函数自动忽略NaN值</span>
<span class="n">prices</span> <span class="o">*</span> <span class="n">volume</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[10]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AAPL</th>
      <th>JNJ</th>
      <th>SPX</th>
      <th>XOM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-09-06</th>
      <td>6.901205e+09</td>
      <td>1.024434e+09</td>
      <td>NaN</td>
      <td>1.808370e+09</td>
    </tr>
    <tr>
      <th>2011-09-07</th>
      <td>4.796054e+09</td>
      <td>7.040072e+08</td>
      <td>NaN</td>
      <td>1.701934e+09</td>
    </tr>
    <tr>
      <th>2011-09-08</th>
      <td>5.700561e+09</td>
      <td>1.010070e+09</td>
      <td>NaN</td>
      <td>1.633702e+09</td>
    </tr>
    <tr>
      <th>2011-09-09</th>
      <td>7.614489e+09</td>
      <td>1.082402e+09</td>
      <td>NaN</td>
      <td>1.986086e+09</td>
    </tr>
    <tr>
      <th>2011-09-12</th>
      <td>6.343972e+09</td>
      <td>8.551710e+08</td>
      <td>NaN</td>
      <td>1.882625e+09</td>
    </tr>
    <tr>
      <th>2011-09-13</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-09-14</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 计算基于成交量的加权平均价</span>
<span class="n">vwap</span> <span class="o">=</span> <span class="p">(</span><span class="n">prices</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vwap</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[9]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>AAPL    380.655181
JNJ      64.394769
SPX            NaN
XOM      72.024288
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vwap</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[12]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>AAPL    380.655181
JNJ      64.394769
XOM      72.024288
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 如果需要手工对齐，可以使用DataFrame的align方法</span>
<span class="n">prices</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[13]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(              AAPL    JNJ    XOM
 2011-09-06  379.74  64.64  71.15
 2011-09-07  383.93  65.43  73.65
 2011-09-08  384.14  64.95  72.82
 2011-09-09  377.48  63.64  71.01
 2011-09-12  379.94  63.59  71.84,
                   AAPL         JNJ         XOM
 2011-09-06  18173500.0  15848300.0  25416300.0
 2011-09-07  12492000.0  10759700.0  23108400.0
 2011-09-08  14839800.0  15551500.0  22434800.0
 2011-09-09  20171900.0  17008200.0  27969100.0
 2011-09-12  16697300.0  13448200.0  26205800.0)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 通过一组索引可能不同的Series构建DataFrame</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
<span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="n">s1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="n">s2</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="n">s3</span><span class="p">})</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[14]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>f</th>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 可以指定结果的索引（丢弃其余的数据）</span>
<span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="n">s1</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="n">s2</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="n">s3</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[15]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>f</th>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>a</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#39057;&#29575;&#19981;&#21516;&#30340;&#26102;&#38388;&#25353;&#24207;&#21015;&#30340;&#36816;&#31639;">&#39057;&#29575;&#19981;&#21516;&#30340;&#26102;&#38388;&#25353;&#24207;&#21015;&#30340;&#36816;&#31639;<a class="anchor-link" href="#&#39057;&#29575;&#19981;&#21516;&#30340;&#26102;&#38388;&#25353;&#24207;&#21015;&#30340;&#36816;&#31639;">&#182;</a></h2><p>经济学时间序列常常按年月日等频率进行数据统计。但有些是无规律的。</p>
<p>频率转换和重对齐的主要工具是resample 和 reindex 方法：</p>
<ul>
<li>resample 用于将数据转换到固定频率</li>
<li>reindex 用于使数据符合一个新索引</li>
</ul>
<p>二者都支持插值逻辑。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 一个简单的周时间序列</span>
<span class="n">ts1</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
             <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2012-6-13&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W-WED&#39;</span><span class="p">))</span>
<span class="n">ts1</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[18]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-13   -0.928173
2012-06-20    0.506413
2012-06-27    1.052517
Freq: W-WED, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 重采样到工作日，就会有缺省值出现</span>
<span class="n">ts1</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[19]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-13   -0.928173
2012-06-14         NaN
2012-06-15         NaN
2012-06-18         NaN
2012-06-19         NaN
2012-06-20    0.506413
2012-06-21         NaN
2012-06-22         NaN
2012-06-25         NaN
2012-06-26         NaN
2012-06-27    1.052517
Freq: B, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 用前面的值填充 NaN</span>
<span class="n">ts1</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[23]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-13   -0.928173
2012-06-14   -0.928173
2012-06-15   -0.928173
2012-06-18   -0.928173
2012-06-19   -0.928173
2012-06-20    0.506413
2012-06-21    0.506413
2012-06-22    0.506413
2012-06-25    0.506413
2012-06-26    0.506413
2012-06-27    1.052517
Freq: B, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 更一般的不规则时间序列</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-6-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-6-17&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-6-18&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;2012-6-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-6-22&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-6-29&#39;</span><span class="p">])</span>
<span class="n">ts2</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="n">ts2</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[24]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-12    0.131619
2012-06-17    1.440314
2012-06-18    0.780129
2012-06-21    1.024207
2012-06-22   -0.660424
2012-06-29   -0.218203
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 如果想将处理过后的ts1加到ts2上，可以先将两个频率弄相同再相加</span>
<span class="c1"># 也可以用reindex方法，维持 ts2 的日期索引</span>
<span class="n">ts1</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[26]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-12         NaN
2012-06-17   -0.928173
2012-06-18   -0.928173
2012-06-21    0.506413
2012-06-22    0.506413
2012-06-29    1.052517
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ts2</span> <span class="o">+</span> <span class="n">ts1</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[27]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-12         NaN
2012-06-17    0.512141
2012-06-18   -0.148044
2012-06-21    1.530620
2012-06-22   -0.154011
2012-06-29    0.834314
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#20351;&#29992;-Period">&#20351;&#29992; Period<a class="anchor-link" href="#&#20351;&#29992;-Period">&#182;</a></h3><p>Period 提供了另一种处理不同频率时间序列的方法。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 比如，一个公司可能会发布其以6月结尾的财年的每季度盈利报告，即频率为Q-JUN</span>
<span class="n">gdp</span> <span class="o">=</span> <span class="n">Series</span><span class="p">([</span><span class="mf">1.78</span><span class="p">,</span> <span class="mf">1.94</span><span class="p">,</span> <span class="mf">2.08</span><span class="p">,</span> <span class="mf">2.01</span><span class="p">,</span> <span class="mf">2.15</span><span class="p">,</span> <span class="mf">2.31</span><span class="p">,</span> <span class="mf">2.46</span><span class="p">],</span>
             <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;1984Q2&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q-SEP&#39;</span><span class="p">))</span>
<span class="n">infl</span> <span class="o">=</span> <span class="n">Series</span><span class="p">([</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.045</span><span class="p">,</span> <span class="mf">0.037</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">],</span>
              <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;1982&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;A-DEC&#39;</span><span class="p">))</span>
<span class="n">gdp</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[28]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>1984Q2    1.78
1984Q3    1.94
1984Q4    2.08
1985Q1    2.01
1985Q2    2.15
1985Q3    2.31
1985Q4    2.46
Freq: Q-SEP, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">infl</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[29]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>1982    0.025
1983    0.045
1984    0.037
1985    0.040
Freq: A-DEC, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 与Timestamp的时间序列不同，由period索引的不同频率的时间序列之间的运算必须进行显示转换</span>
<span class="c1"># 假设已知 infl 值是每年年末观测的，于是可以将其转换为 Q-SEP ，以得到改频率下的正确时期</span>
<span class="n">infl_q</span> <span class="o">=</span> <span class="n">infl</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;Q-SEP&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">infl_q</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[31]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>1983Q1    0.025
1984Q1    0.045
1985Q1    0.037
1986Q1    0.040
Freq: Q-SEP, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 显示转换以后，就可以被重新索引了（使用向前填充ffill ,以匹配gdp）</span>
<span class="n">infl_q</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">gdp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[32]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>1984Q2    0.045
1984Q3    0.045
1984Q4    0.045
1985Q1    0.037
1985Q2    0.037
1985Q3    0.037
1985Q4    0.037
Freq: Q-SEP, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#26102;&#38388;&#21644;&#8220;&#26368;&#24403;&#21069;&#8221;&#25968;&#25454;&#36873;&#21462;">&#26102;&#38388;&#21644;&#8220;&#26368;&#24403;&#21069;&#8221;&#25968;&#25454;&#36873;&#21462;<a class="anchor-link" href="#&#26102;&#38388;&#21644;&#8220;&#26368;&#24403;&#21069;&#8221;&#25968;&#25454;&#36873;&#21462;">&#182;</a></h3><p>假设有一个很长的盘中数据，希望抽取其中每天特定时间的价格数据。如果数据不规整该怎么办？</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Make an intraday date range and time series</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2012-06-01 09:30&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-06-01 15:59&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="c1"># Make a 5-day series of 9:30-15:59 values</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rng</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[34]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-01 09:30:00    0.0
2012-06-01 09:31:00    1.0
2012-06-01 09:32:00    2.0
2012-06-01 09:33:00    3.0
2012-06-01 09:34:00    4.0
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 只取10点钟的数据</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">time</span>
<span class="n">ts</span><span class="p">[</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[37]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-01 10:00:00      30.0
2012-06-04 10:00:00     420.0
2012-06-05 10:00:00     810.0
2012-06-06 10:00:00    1200.0
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 该操作实际上用了实例方法at_time（各时间序列以及类似的DataFrame对象都有）</span>
<span class="n">ts</span><span class="o">.</span><span class="n">at_time</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[38]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-01 10:00:00      30.0
2012-06-04 10:00:00     420.0
2012-06-05 10:00:00     810.0
2012-06-06 10:00:00    1200.0
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 选取两个Time对象之间的值</span>
<span class="n">ts</span><span class="o">.</span><span class="n">between_time</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[39]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-01 10:00:00      30.0
2012-06-01 10:01:00      31.0
2012-06-04 10:00:00     420.0
2012-06-04 10:01:00     421.0
2012-06-05 10:00:00     810.0
2012-06-05 10:01:00     811.0
2012-06-06 10:00:00    1200.0
2012-06-06 10:01:00    1201.0
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 可能刚好就没有任何数据落在某个具体的时间上（比如上午10点）。这时，可能会希望得到上午10点之前最后出现的值</span>
<span class="c1">#下面将该时间序列的大部分内容随机设置为NA</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12346</span><span class="p">)</span>
<span class="n">indexer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">))[</span><span class="mi">700</span><span class="p">:])</span>
<span class="n">irr_ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">irr_ts</span><span class="p">[</span><span class="n">indexer</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">irr_ts</span><span class="p">[</span><span class="s1">&#39;2012-06-01 09:50&#39;</span><span class="p">:</span><span class="s1">&#39;2012-06-01 10:00&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[40]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-01 09:50:00    20.0
2012-06-01 09:51:00     NaN
2012-06-01 09:52:00    22.0
2012-06-01 09:53:00    23.0
2012-06-01 09:54:00     NaN
2012-06-01 09:55:00    25.0
2012-06-01 09:56:00     NaN
2012-06-01 09:57:00     NaN
2012-06-01 09:58:00     NaN
2012-06-01 09:59:00     NaN
2012-06-01 10:00:00     NaN
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#如果将一组Timestamp传入asof方法，就能得到这些时间点处（或其之前最近）的有效值（非NA）。</span>
<span class="c1"># 例如，构造一个日期范围（每天上午10点），然后将其传入asof</span>
<span class="n">selection</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2012-06-01 10:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
<span class="n">irr_ts</span><span class="o">.</span><span class="n">asof</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[41]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2012-06-01 10:00:00      25.0
2012-06-04 10:00:00     420.0
2012-06-05 10:00:00     810.0
2012-06-06 10:00:00    1197.0
Freq: B, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#25340;&#25509;&#22810;&#20010;&#25968;&#25454;&#28304;">&#25340;&#25509;&#22810;&#20010;&#25968;&#25454;&#28304;<a class="anchor-link" href="#&#25340;&#25509;&#22810;&#20010;&#25968;&#25454;&#28304;">&#182;</a></h2><p>在第七章中曾经介绍了数据拼接的知识，在金融或经济中，还有另外几个经常出现的情况：</p>
<ul>
<li>在一个特定的时间点上，从一个数据源切换到另一个数据源</li>
<li>用另一个时间序列对当前时间序列中的缺失值“打补丁”</li>
<li>将数据中的符号（国家、资产代码等）替换为实际数据</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 关于特定时间的数据源切换，就是用concat函数进行连接</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
                  <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;6/12/2012&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
                  <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;6/13/2012&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
<span class="n">spliced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data1</span><span class="o">.</span><span class="n">ix</span><span class="p">[:</span><span class="s1">&#39;2012-06-14&#39;</span><span class="p">],</span> <span class="n">data2</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s1">&#39;2012-06-15&#39;</span><span class="p">:]])</span>
<span class="n">spliced</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[42]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-06-12</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2012-06-13</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2012-06-14</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2012-06-15</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-16</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-17</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-18</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 假设data1缺失了data2中存在的某个时间序列</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
                  <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;6/13/2012&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
<span class="n">spliced</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data1</span><span class="o">.</span><span class="n">ix</span><span class="p">[:</span><span class="s1">&#39;2012-06-14&#39;</span><span class="p">],</span> <span class="n">data2</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s1">&#39;2012-06-15&#39;</span><span class="p">:]])</span>
<span class="n">spliced</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[43]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-06-12</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2012-06-13</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2012-06-14</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2012-06-15</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-16</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-17</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-18</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># combine_first可以引入合并点之前的数据，这样也就扩展了&#39;d&#39;项的历史</span>
<span class="n">spliced_filled</span> <span class="o">=</span> <span class="n">spliced</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
<span class="n">spliced_filled</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[44]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-06-12</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2012-06-13</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-14</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-15</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-16</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-17</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-18</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># DataFrame也有一个类似的方法update，它可以实现就地更新</span>
<span class="c1"># 如果只想填充空洞，则必须差U纳入overwrite = False才行</span>
<span class="c1"># 不传入overwrite会把整条数据都覆盖</span>

<span class="n">spliced</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">spliced</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[46]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-06-12</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2012-06-13</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-14</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-15</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-16</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-17</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-18</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 上面所讲的技术可以将数据中的符号替换为实际数据</span>
<span class="c1"># 但有时利用 DataFrame的索引机制直接进行设置会更简单一些</span>
<span class="n">cp_spliced</span> <span class="o">=</span> <span class="n">spliced</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cp_spliced</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data1</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]]</span>
<span class="n">cp_spliced</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[47]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-06-12</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2012-06-13</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-14</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-15</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-16</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-17</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2012-06-18</th>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#25910;&#30410;&#25351;&#25968;&#21644;&#32047;&#35745;&#25910;&#30410;">&#25910;&#30410;&#25351;&#25968;&#21644;&#32047;&#35745;&#25910;&#30410;<a class="anchor-link" href="#&#25910;&#30410;&#25351;&#25968;&#21644;&#32047;&#35745;&#25910;&#30410;">&#182;</a></h2><p>金融领域中，收益（return）通常指的是某资产价格的百分比变化。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 2011到2012年苹果公司的股票价格数据</span>
<span class="kn">from</span> <span class="nn">pandas_datareader</span> <span class="k">import</span> <span class="n">data</span><span class="p">,</span> <span class="n">yahoo</span>
<span class="n">price</span> <span class="o">=</span><span class="n">yahoo</span><span class="o">.</span><span class="n">daily</span><span class="o">.</span><span class="n">YahooDailyReader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>
<span class="n">price</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-69-1c64e0491f72&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 2011到2012年苹果公司的股票价格数据</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-intense-fg ansi-bold">from</span> pandas_datareader <span class="ansi-green-intense-fg ansi-bold">import</span> data<span class="ansi-yellow-intense-fg ansi-bold">,</span> yahoo
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>price <span class="ansi-yellow-intense-fg ansi-bold">=</span>yahoo<span class="ansi-yellow-intense-fg ansi-bold">.</span>daily<span class="ansi-yellow-intense-fg ansi-bold">.</span>YahooDailyReader<span class="ansi-yellow-intense-fg ansi-bold">.</span>read<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;AAPL&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> price<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">-</span><span class="ansi-cyan-intense-fg ansi-bold">5</span><span class="ansi-yellow-intense-fg ansi-bold">:</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\yahoo\daily.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> read<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34; read one data from specified URL &#34;&#34;&#34;</span>
<span class="ansi-green-fg">---&gt; 77</span><span class="ansi-red-fg">         </span>df <span class="ansi-yellow-intense-fg ansi-bold">=</span> super<span class="ansi-yellow-intense-fg ansi-bold">(</span>YahooDailyReader<span class="ansi-yellow-intense-fg ansi-bold">,</span> self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>read<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>ret_index<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>             df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Ret_Index&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> _calc_return_index<span class="ansi-yellow-intense-fg ansi-bold">(</span>df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">TypeError</span>: super(type, obj): obj must be an instance or subtype of type</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 计算两个时间点之间的累计百分比回报只需计算价格的百分比变化即可</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;2011-10-03&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;2011-3-01&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 通常会先算出一个收益指数，它表示单位投资（比如1美元）收益的时间序列</span>
<span class="c1"># 从收益指数中可以得出许多假设。例如，人们可以决定是否进行利润再投资</span>
<span class="c1"># 可以用cumprod计算出一个简单的收益指数</span>

<span class="n">returns</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="n">ret_index</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">returns</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="n">ret_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Set first value to 1</span>
<span class="n">ret_index</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 得到收益指数之后，计算指定时期内的累计收益就很简单了</span>
<span class="n">m_returns</span> <span class="o">=</span> <span class="n">ret_index</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;BM&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="n">m_returns</span><span class="p">[</span><span class="s1">&#39;2012&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-70-b1657b385e76&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 得到收益指数之后，计算指定时期内的累计收益就很简单了</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>m_returns <span class="ansi-yellow-intense-fg ansi-bold">=</span> ret_index<span class="ansi-yellow-intense-fg ansi-bold">.</span>resample<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;BM&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> how<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;last&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>pct_change<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> m_returns<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;2012&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ret_index&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#如果知道了股息的派发日和支付率，就可以将它们计入到每日总收益中</span>
<span class="n">m_rets</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">returns</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">m_rets</span><span class="p">[</span><span class="s1">&#39;2012&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-71-3ca97f7f2ac8&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold">#如果知道了股息的派发日和支付率，就可以将它们计入到每日总收益中</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>m_rets <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-cyan-intense-fg ansi-bold">1</span> <span class="ansi-yellow-intense-fg ansi-bold">+</span> returns<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>resample<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;M&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> how<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;prod&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> kind<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;period&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">-</span> <span class="ansi-cyan-intense-fg ansi-bold">1</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> m_rets<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;2012&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>

<span class="ansi-red-fg">NameError</span>: name &#39;returns&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">returns</span><span class="p">[</span><span class="n">dividend_dates</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dividend_pcts</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-72-2136d75d50a0&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>returns<span class="ansi-yellow-intense-fg ansi-bold">[</span>dividend_dates<span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">+=</span> dividend_pcts

<span class="ansi-red-fg">NameError</span>: name &#39;returns&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>
</div>

<h1 id="分组变换和分析"><a href="#分组变换和分析" class="headerlink" title="分组变换和分析"></a>分组变换和分析</h1><a href="/2017/07/24/python_data_analysis11/index.html/python_data_analysis11-2.ipynb" title="下载ipynb">下载ipynb</a>

<div class="notebook-border">
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div id="notebook-container">
      
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>《<a href="https://book.douban.com/subject/25779298/" target="_blank" rel="external">利用Python进行数据分析</a>》读书笔记。</p>
<p><a href="/2017/07/24/python_data_analysis11.html">第11章</a>  第2节：分组变换和分析</p>
<p>所有用到的数据可以从<a href="https://github.com/wesm/pydata-book" target="_blank" rel="external">作者的 github</a>下载。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Populating the interactive namespace from numpy and matplotlib
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>在第九章中，已经学习了分组统计的基础，还学习了如何对数据集的分组应用自定义的变换函数。</p>
<p>下面以一组假想的投资组合为例。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_columns</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">import</span> <span class="nn">random</span><span class="p">;</span> <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="c1">#首先生成1000个股票代码</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">def</span> <span class="nf">rands</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
<span class="n">tickers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rands</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 创建一个含有3列的DataFrame来承载这些假想数据，不过只选择部分股票组成该投资组合</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Momentum&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">/</span> <span class="mi">200</span> <span class="o">+</span> <span class="mf">0.03</span><span class="p">,</span>
                <span class="s1">&#39;Value&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">/</span> <span class="mi">200</span> <span class="o">+</span> <span class="mf">0.08</span><span class="p">,</span>
                <span class="s1">&#39;ShortInterest&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">/</span> <span class="mi">200</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">},</span>
                <span class="n">index</span><span class="o">=</span><span class="n">tickers</span><span class="p">[:</span><span class="n">M</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 随机创建行业分类</span>
<span class="n">ind_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;FINANCIAL&#39;</span><span class="p">,</span> <span class="s1">&#39;TECH&#39;</span><span class="p">])</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_names</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>
<span class="n">industries</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">ind_names</span><span class="p">[</span><span class="n">sampler</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">tickers</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;industry&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 根据行业分类进行分组并执行分组聚合和变换</span>
<span class="n">by_industry</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">industries</span><span class="p">)</span>
<span class="n">by_industry</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[9]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Momentum</th>
      <th>ShortInterest</th>
      <th>Value</th>
    </tr>
    <tr>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FINANCIAL</th>
      <td>0.029485</td>
      <td>-0.020739</td>
      <td>0.079929</td>
    </tr>
    <tr>
      <th>TECH</th>
      <td>0.030407</td>
      <td>-0.019609</td>
      <td>0.080113</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">by_industry</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[10]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Momentum</th>
      <th>ShortInterest</th>
      <th>Value</th>
    </tr>
    <tr>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="8" valign="top">FINANCIAL</th>
      <th>count</th>
      <td>246.000000</td>
      <td>246.000000</td>
      <td>246.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.029485</td>
      <td>-0.020739</td>
      <td>0.079929</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.004802</td>
      <td>0.004986</td>
      <td>0.004548</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.017210</td>
      <td>-0.036997</td>
      <td>0.067025</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.026263</td>
      <td>-0.024138</td>
      <td>0.076638</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.029261</td>
      <td>-0.020833</td>
      <td>0.079804</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.032806</td>
      <td>-0.017345</td>
      <td>0.082718</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.045884</td>
      <td>-0.006322</td>
      <td>0.093334</td>
    </tr>
    <tr>
      <th rowspan="8" valign="top">TECH</th>
      <th>count</th>
      <td>254.000000</td>
      <td>254.000000</td>
      <td>254.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.030407</td>
      <td>-0.019609</td>
      <td>0.080113</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.005303</td>
      <td>0.005074</td>
      <td>0.004886</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.016778</td>
      <td>-0.032682</td>
      <td>0.065253</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.026456</td>
      <td>-0.022779</td>
      <td>0.076737</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.030650</td>
      <td>-0.019829</td>
      <td>0.080296</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.033602</td>
      <td>-0.016923</td>
      <td>0.083353</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.049638</td>
      <td>-0.003698</td>
      <td>0.093081</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 自定义变换：行业内标准化处理（平均值为 0 ，标准差为 1 ）</span>
<span class="k">def</span> <span class="nf">zscore</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">group</span> <span class="o">-</span> <span class="n">group</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">group</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">df_stand</span> <span class="o">=</span> <span class="n">by_industry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_stand</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">industries</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[12]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Momentum</th>
      <th colspan="2" halign="left">ShortInterest</th>
      <th colspan="2" halign="left">Value</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
    </tr>
    <tr>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FINANCIAL</th>
      <td>1.114736e-15</td>
      <td>1.0</td>
      <td>3.081772e-15</td>
      <td>1.0</td>
      <td>8.001278e-15</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>TECH</th>
      <td>-2.779929e-16</td>
      <td>1.0</td>
      <td>-1.910982e-15</td>
      <td>1.0</td>
      <td>-7.139521e-15</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 内置变换函数（比如rank）的用法会更简洁一些</span>
<span class="n">ind_rank</span> <span class="o">=</span> <span class="n">by_industry</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ind_rank</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">industries</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[14]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Momentum</th>
      <th colspan="2" halign="left">ShortInterest</th>
      <th colspan="2" halign="left">Value</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>min</th>
      <th>max</th>
      <th>min</th>
      <th>max</th>
    </tr>
    <tr>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FINANCIAL</th>
      <td>1.0</td>
      <td>246.0</td>
      <td>1.0</td>
      <td>246.0</td>
      <td>1.0</td>
      <td>246.0</td>
    </tr>
    <tr>
      <th>TECH</th>
      <td>1.0</td>
      <td>254.0</td>
      <td>1.0</td>
      <td>254.0</td>
      <td>1.0</td>
      <td>254.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 在股票投资组合的定量分析中，排名和标准化是一种常见的变换运算组合。</span>
<span class="c1"># 通过rank和zscore链接在一起即可完成整个过程</span>
<span class="c1"># 行业内排名和标准化,这是把排名进行了标准化</span>
<span class="c1"># Industry rank and standardize</span>
<span class="n">by_industry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">zscore</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">rank</span><span class="p">()))</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[16]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Momentum</th>
      <th>ShortInterest</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MYNBI</th>
      <td>-0.091346</td>
      <td>-0.976696</td>
      <td>-1.004802</td>
    </tr>
    <tr>
      <th>QPMZJ</th>
      <td>0.794005</td>
      <td>1.299919</td>
      <td>-0.358356</td>
    </tr>
    <tr>
      <th>PLSGQ</th>
      <td>-0.541047</td>
      <td>-0.836164</td>
      <td>-1.679355</td>
    </tr>
    <tr>
      <th>EJEYD</th>
      <td>-0.583207</td>
      <td>-1.623142</td>
      <td>0.990749</td>
    </tr>
    <tr>
      <th>TZIRW</th>
      <td>1.572120</td>
      <td>-0.265423</td>
      <td>0.374314</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#20998;&#32452;&#22240;&#23376;&#26292;&#38706;">&#20998;&#32452;&#22240;&#23376;&#26292;&#38706;<a class="anchor-link" href="#&#20998;&#32452;&#22240;&#23376;&#26292;&#38706;">&#182;</a></h2><p>因子分析（factor analysis）是投资组合定量管理中的一种技术。</p>
<p>投资组合的持有量和性能（收益与损失）可以被分解为一个或多个表示投资组合权重的因子（风险因子就是其中之一）。</p>
<p>例如，某只股票与某个基准（比如标普500指数）的协动性被称为其beta风险系数。</p>
<p>下面以一个人为构成的投资的投资组合为例进行讲解，它由三个随机生成的因子（通常称为因子载荷）和一些权重构成。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="n">rand</span>
<span class="n">fac1</span><span class="p">,</span> <span class="n">fac2</span><span class="p">,</span> <span class="n">fac3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">ticker_subset</span> <span class="o">=</span> <span class="n">tickers</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">N</span><span class="p">)[:</span><span class="mi">1000</span><span class="p">])</span>

<span class="c1"># 因子加权和，噪声</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="mf">0.7</span> <span class="o">*</span> <span class="n">fac1</span> <span class="o">-</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">fac2</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">fac3</span> <span class="o">+</span> <span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
              <span class="n">index</span><span class="o">=</span><span class="n">ticker_subset</span><span class="p">)</span>
<span class="n">factors</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;f1&#39;</span><span class="p">:</span> <span class="n">fac1</span><span class="p">,</span> <span class="s1">&#39;f2&#39;</span><span class="p">:</span> <span class="n">fac2</span><span class="p">,</span> <span class="s1">&#39;f3&#39;</span><span class="p">:</span> <span class="n">fac3</span><span class="p">},</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">ticker_subset</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 各因子与投资组合之间的矢量相关性可能说明不了什么问题</span>
<span class="n">factors</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[18]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>f1    0.402377
f2   -0.680980
f3    0.168083
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#计算因子暴露的标准方式是最小二乘回归， 可以使用pandas.ols</span>
<span class="n">pd</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">factors</span><span class="p">)</span><span class="o">.</span><span class="n">beta</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\ProgramData\Anaconda3\lib\site-packages\IPython\core\interactiveshell.py:2881: FutureWarning: The pandas.stats.ols module is deprecated and will be removed in a future version. We refer to external packages like statsmodels, see some examples here: http://www.statsmodels.org/stable/regression.html
  exec(code_obj, self.user_global_ns, self.user_ns)
</pre>
</div>
</div>

<div class="output_area"><div class="prompt output_prompt">Out[19]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>f1           0.761789
f2          -1.208760
f3           0.289865
intercept    0.484477
dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#可以看出，由于没有给投资组合添加过多的随机噪声，所以原始因子基本恢复了。</span>
<span class="c1"># 还可以通过groupby计算各行业的暴露量</span>
<span class="k">def</span> <span class="nf">beta_exposure</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">factors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">factors</span><span class="p">)</span><span class="o">.</span><span class="n">beta</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 根据行业进行分组，并应用该函数</span>
<span class="n">by_ind</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">industries</span><span class="p">)</span>
<span class="n">exposures</span> <span class="o">=</span> <span class="n">by_ind</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">beta_exposure</span><span class="p">,</span> <span class="n">factors</span><span class="o">=</span><span class="n">factors</span><span class="p">)</span>
<span class="n">exposures</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\groupby.py:685: FutureWarning: The pandas.stats.ols module is deprecated and will be removed in a future version. We refer to external packages like statsmodels, see some examples here: http://www.statsmodels.org/stable/regression.html
  return func(g, *args, **kwargs)
</pre>
</div>
</div>

<div class="output_area"><div class="prompt output_prompt">Out[22]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>f1</th>
      <th>f2</th>
      <th>f3</th>
      <th>intercept</th>
    </tr>
    <tr>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FINANCIAL</th>
      <td>0.790329</td>
      <td>-1.182970</td>
      <td>0.275624</td>
      <td>0.455569</td>
    </tr>
    <tr>
      <th>TECH</th>
      <td>0.740857</td>
      <td>-1.232882</td>
      <td>0.303811</td>
      <td>0.508188</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#21313;&#20998;&#20301;&#21644;&#22235;&#20998;&#20301;&#20998;&#26512;">&#21313;&#20998;&#20301;&#21644;&#22235;&#20998;&#20301;&#20998;&#26512;<a class="anchor-link" href="#&#21313;&#20998;&#20301;&#21644;&#22235;&#20998;&#20301;&#20998;&#26512;">&#182;</a></h2><p>基于样本分位数的分析是金融分析师们的另一个重要工具，</p>
<p>例如，股票投资组合的性能可以根据各股的市盈率被划分入四分位。</p>
<p>通过pandas.qcut和groupby可以轻松实现分位数分析。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas.io.data</span> <span class="k">as</span> <span class="nn">web</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="s1">&#39;SPY&#39;</span><span class="p">,</span> <span class="s1">&#39;2006-01-01&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ImportError</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-24-26e850125bda&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-intense-fg ansi-bold">import</span> pandas<span class="ansi-yellow-intense-fg ansi-bold">.</span>io<span class="ansi-yellow-intense-fg ansi-bold">.</span>data <span class="ansi-green-intense-fg ansi-bold">as</span> web
<span class="ansi-green-intense-fg ansi-bold">      2</span> data <span class="ansi-yellow-intense-fg ansi-bold">=</span> web<span class="ansi-yellow-intense-fg ansi-bold">.</span>get_data_yahoo<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;SPY&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;2006-01-01&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> data<span class="ansi-yellow-intense-fg ansi-bold">.</span>info<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\io\data.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> raise ImportError(
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span><span class="ansi-blue-intense-fg ansi-bold">&#34;The pandas.io.data module is moved to a separate package &#34;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     <span class="ansi-blue-intense-fg ansi-bold">&#34;(pandas-datareader). After installing the pandas-datareader package &#34;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-blue-intense-fg ansi-bold">&#34;(https://github.com/pandas-dev/pandas-datareader), you can change &#34;</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     <span class="ansi-blue-intense-fg ansi-bold">&#34;the import ``from pandas.io import data, wb`` to &#34;</span>

<span class="ansi-red-fg">ImportError</span>: The pandas.io.data module is moved to a separate package (pandas-datareader). After installing the pandas-datareader package (https://github.com/pandas-dev/pandas-datareader), you can change the import ``from pandas.io import data, wb`` to ``from pandas_datareader import data, wb``.</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 计算日收益率，并编写一个用于将收益率转换为趋势信号的函数</span>

<span class="n">px</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>
<span class="n">returns</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">to_index</span><span class="p">(</span><span class="n">rets</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rets</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
    <span class="n">first_loc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">first_loc</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">index</span>

<span class="k">def</span> <span class="nf">trend_signal</span><span class="p">(</span><span class="n">rets</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="n">lag</span><span class="p">):</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">rolling_sum</span><span class="p">(</span><span class="n">rets</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">lookback</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-25-4b81d1bad1a6&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 计算日收益率，并编写一个用于将收益率转换为趋势信号的函数</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> 
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>px <span class="ansi-yellow-intense-fg ansi-bold">=</span> data<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> returns <span class="ansi-yellow-intense-fg ansi-bold">=</span> px<span class="ansi-yellow-intense-fg ansi-bold">.</span>pct_change<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> 

<span class="ansi-red-fg">NameError</span>: name &#39;data&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 通过该函数，我们可以单纯地创建和测试一种根据每周五动量信号进行交易的交易策略</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">trend_signal</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">trade_friday</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">fill_method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
<span class="n">trade_rets</span> <span class="o">=</span> <span class="n">trade_friday</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">returns</span>
<span class="n">trade_rets</span> <span class="o">=</span> <span class="n">trade_rets</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-26-fb0073b1d37d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 通过该函数，我们可以单纯地创建和测试一种根据每周五动量信号进行交易的交易策略</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>signal <span class="ansi-yellow-intense-fg ansi-bold">=</span> trend_signal<span class="ansi-yellow-intense-fg ansi-bold">(</span>returns<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">100</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">3</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> trade_friday <span class="ansi-yellow-intense-fg ansi-bold">=</span> signal<span class="ansi-yellow-intense-fg ansi-bold">.</span>resample<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;W-FRI&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>resample<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;B&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> fill_method<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;ffill&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> trade_rets <span class="ansi-yellow-intense-fg ansi-bold">=</span> trade_friday<span class="ansi-yellow-intense-fg ansi-bold">.</span>shift<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">*</span> returns
<span class="ansi-green-intense-fg ansi-bold">      5</span> trade_rets <span class="ansi-yellow-intense-fg ansi-bold">=</span> trade_rets<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>len<span class="ansi-yellow-intense-fg ansi-bold">(</span>returns<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>

<span class="ansi-red-fg">NameError</span>: name &#39;trend_signal&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 将该策略的收益率转换为一个收益指数，并绘制一张图表</span>
<span class="n">to_index</span><span class="p">(</span><span class="n">trade_rets</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-27-adbb6b68a3f3&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 将该策略的收益率转换为一个收益指数，并绘制一张图表</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>to_index<span class="ansi-yellow-intense-fg ansi-bold">(</span>trade_rets<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>plot<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;to_index&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 假如希望将该策略的性能按不同大小的交易期波幅进行划分。</span>
<span class="c1"># 年度标准差是计算波幅的一种简单办法，可以通过计算夏普比率来观察不同波动机制下的风险收益率：</span>

<span class="n">vol</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">rolling_std</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sharpe</span><span class="p">(</span><span class="n">rets</span><span class="p">,</span> <span class="n">ann</span><span class="o">=</span><span class="mi">250</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">rets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">rets</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-28-7bfb63db4a01&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-red-intense-fg ansi-bold"># 年度标准差是计算波幅的一种简单办法，可以通过计算夏普比率来观察不同波动机制下的风险收益率：</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> 
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> </span>vol <span class="ansi-yellow-intense-fg ansi-bold">=</span> pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>rolling_std<span class="ansi-yellow-intense-fg ansi-bold">(</span>returns<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">250</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> min_periods<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">200</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">*</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>sqrt<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-cyan-intense-fg ansi-bold">250</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> 
<span class="ansi-green-intense-fg ansi-bold">      6</span> <span class="ansi-green-intense-fg ansi-bold">def</span> sharpe<span class="ansi-yellow-intense-fg ansi-bold">(</span>rets<span class="ansi-yellow-intense-fg ansi-bold">,</span> ann<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">250</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-red-fg">NameError</span>: name &#39;returns&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 现在利用qcut将vol划分为4等份，并用sharpe进行聚合</span>
<span class="n">cats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cats: </span><span class="si">%d</span><span class="s1">, trade_rets: </span><span class="si">%d</span><span class="s1">, vol: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">trade_rets</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">vol</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-29-daca98ef2bb1&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 现在利用qcut将vol划分为4等份，并用sharpe进行聚合</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>cats <span class="ansi-yellow-intense-fg ansi-bold">=</span> pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>qcut<span class="ansi-yellow-intense-fg ansi-bold">(</span>vol<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">4</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> print<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;cats: %d, trade_rets: %d, vol: %d&#39;</span> <span class="ansi-yellow-intense-fg ansi-bold">%</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span>len<span class="ansi-yellow-intense-fg ansi-bold">(</span>cats<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> len<span class="ansi-yellow-intense-fg ansi-bold">(</span>trade_rets<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> len<span class="ansi-yellow-intense-fg ansi-bold">(</span>vol<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;vol&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trade_rets</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">sharpe</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-30-27c438e4e892&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>trade_rets<span class="ansi-yellow-intense-fg ansi-bold">.</span>groupby<span class="ansi-yellow-intense-fg ansi-bold">(</span>cats<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>agg<span class="ansi-yellow-intense-fg ansi-bold">(</span>sharpe<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;trade_rets&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>
</div>

<h1 id="更多示例应用"><a href="#更多示例应用" class="headerlink" title="更多示例应用"></a>更多示例应用</h1><a href="/2017/07/24/python_data_analysis11/index.html/python_data_analysis11-3.ipynb" title="下载ipynb">下载ipynb</a>

<div class="notebook-border">
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div id="notebook-container">
      
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>《<a href="https://book.douban.com/subject/25779298/" target="_blank" rel="external">利用Python进行数据分析</a>》读书笔记。</p>
<p><a href="/2017/07/24/python_data_analysis11.html">第11章</a>  第3节：更多示例应用</p>
<p>所有用到的数据可以从<a href="https://github.com/wesm/pydata-book" target="_blank" rel="external">作者的 github</a>下载。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Populating the interactive namespace from numpy and matplotlib
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#20449;&#21495;&#21069;&#27839;&#20998;&#26512;">&#20449;&#21495;&#21069;&#27839;&#20998;&#26512;<a class="anchor-link" href="#&#20449;&#21495;&#21069;&#27839;&#20998;&#26512;">&#182;</a></h2><p>本小节将介绍一种简化的截面动量投资组合，并得出如何得到模型参数化网格。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 将几只股票做成一个投资组合，并假装历史价格数据</span>
<span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;GOOG&#39;</span><span class="p">,</span> <span class="s1">&#39;MSFT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELL&#39;</span><span class="p">,</span> <span class="s1">&#39;GS&#39;</span><span class="p">,</span> <span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="s1">&#39;BAC&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">get_px</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="s1">&#39;yahoo&#39;</span><span class="p">,</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>
<span class="n">px</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="n">n</span><span class="p">:</span> <span class="n">get_px</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">})</span>

<span class="c1">#px = pd.read_csv(&#39;data/ch11/stock_px.csv&#39;)</span>
<span class="n">px</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">gaierror</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">_new_conn</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>             conn = connection.create_connection(
<span class="ansi-green-fg">--&gt; 138</span><span class="ansi-red-fg">                 (self.host, self.port), self.timeout, **extra_kw)
</span><span class="ansi-green-intense-fg ansi-bold">    139</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\util\connection.py</span> in <span class="ansi-cyan-fg">create_connection</span><span class="ansi-blue-fg">(address, timeout, source_address, socket_options)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 
<span class="ansi-green-fg">---&gt; 75</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">for</span> res <span class="ansi-green-intense-fg ansi-bold">in</span> socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>getaddrinfo<span class="ansi-yellow-intense-fg ansi-bold">(</span>host<span class="ansi-yellow-intense-fg ansi-bold">,</span> port<span class="ansi-yellow-intense-fg ansi-bold">,</span> family<span class="ansi-yellow-intense-fg ansi-bold">,</span> socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>SOCK_STREAM<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         af<span class="ansi-yellow-intense-fg ansi-bold">,</span> socktype<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> canonname<span class="ansi-yellow-intense-fg ansi-bold">,</span> sa <span class="ansi-yellow-intense-fg ansi-bold">=</span> res

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\socket.py</span> in <span class="ansi-cyan-fg">getaddrinfo</span><span class="ansi-blue-fg">(host, port, family, type, proto, flags)</span>
<span class="ansi-green-intense-fg ansi-bold">    742</span>     addrlist <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">--&gt; 743</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">for</span> res <span class="ansi-green-intense-fg ansi-bold">in</span> _socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>getaddrinfo<span class="ansi-yellow-intense-fg ansi-bold">(</span>host<span class="ansi-yellow-intense-fg ansi-bold">,</span> port<span class="ansi-yellow-intense-fg ansi-bold">,</span> family<span class="ansi-yellow-intense-fg ansi-bold">,</span> type<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> flags<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    744</span>         af<span class="ansi-yellow-intense-fg ansi-bold">,</span> socktype<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> canonname<span class="ansi-yellow-intense-fg ansi-bold">,</span> sa <span class="ansi-yellow-intense-fg ansi-bold">=</span> res

<span class="ansi-red-fg">gaierror</span>: [Errno 11004] getaddrinfo failed

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">NewConnectionError</span>                        Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    593</span>                                                   body<span class="ansi-yellow-intense-fg ansi-bold">=</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> headers<span class="ansi-yellow-intense-fg ansi-bold">=</span>headers<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 594</span><span class="ansi-red-fg">                                                   chunked=chunked)
</span><span class="ansi-green-intense-fg ansi-bold">    595</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    360</span>         <span class="ansi-green-intense-fg ansi-bold">else</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 361</span><span class="ansi-red-fg">             </span>conn<span class="ansi-yellow-intense-fg ansi-bold">.</span>request<span class="ansi-yellow-intense-fg ansi-bold">(</span>method<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>httplib_request_kw<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    362</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, body, headers, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1238</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34;Send a complete request to the server.&#34;&#34;&#34;</span>
<span class="ansi-green-fg">-&gt; 1239</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_send_request<span class="ansi-yellow-intense-fg ansi-bold">(</span>method<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> body<span class="ansi-yellow-intense-fg ansi-bold">,</span> headers<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1240</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">_send_request</span><span class="ansi-blue-fg">(self, method, url, body, headers, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1284</span>             body <span class="ansi-yellow-intense-fg ansi-bold">=</span> _encode<span class="ansi-yellow-intense-fg ansi-bold">(</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;body&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">-&gt; 1285</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>endheaders<span class="ansi-yellow-intense-fg ansi-bold">(</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">=</span>encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1286</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">endheaders</span><span class="ansi-blue-fg">(self, message_body, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1233</span>             <span class="ansi-green-intense-fg ansi-bold">raise</span> CannotSendHeader<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">-&gt; 1234</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_send_output<span class="ansi-yellow-intense-fg ansi-bold">(</span>message_body<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">=</span>encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1235</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">_send_output</span><span class="ansi-blue-fg">(self, message_body, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1025</span>         <span class="ansi-green-intense-fg ansi-bold">del</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_buffer<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">:</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">-&gt; 1026</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>msg<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1027</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, data)</span>
<span class="ansi-green-intense-fg ansi-bold">    963</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>auto_open<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 964</span><span class="ansi-red-fg">                 </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>connect<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    965</span>             <span class="ansi-green-intense-fg ansi-bold">else</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">connect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    162</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> connect<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 163</span><span class="ansi-red-fg">         </span>conn <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_new_conn<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    164</span>         self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_prepare_conn<span class="ansi-yellow-intense-fg ansi-bold">(</span>conn<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">_new_conn</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    146</span>             raise NewConnectionError(
<span class="ansi-green-fg">--&gt; 147</span><span class="ansi-red-fg">                 self, &#34;Failed to establish a new connection: %s&#34; % e)
</span><span class="ansi-green-intense-fg ansi-bold">    148</span> 

<span class="ansi-red-fg">NewConnectionError</span>: &lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5C59B0&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">MaxRetryError</span>                             Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    422</span>                     retries<span class="ansi-yellow-intense-fg ansi-bold">=</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>max_retries<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 423</span><span class="ansi-red-fg">                     </span>timeout<span class="ansi-yellow-intense-fg ansi-bold">=</span>timeout
<span class="ansi-green-intense-fg ansi-bold">    424</span>                 )

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    642</span>             retries = retries.increment(method, url, error=e, _pool=self,
<span class="ansi-green-fg">--&gt; 643</span><span class="ansi-red-fg">                                         _stacktrace=sys.exc_info()[2])
</span><span class="ansi-green-intense-fg ansi-bold">    644</span>             retries<span class="ansi-yellow-intense-fg ansi-bold">.</span>sleep<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\util\retry.py</span> in <span class="ansi-cyan-fg">increment</span><span class="ansi-blue-fg">(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="ansi-green-intense-fg ansi-bold">    362</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> new_retry<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_exhausted<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 363</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">raise</span> MaxRetryError<span class="ansi-yellow-intense-fg ansi-bold">(</span>_pool<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> error <span class="ansi-green-intense-fg ansi-bold">or</span> ResponseError<span class="ansi-yellow-intense-fg ansi-bold">(</span>cause<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    364</span> 

<span class="ansi-red-fg">MaxRetryError</span>: HTTPConnectionPool(host=&#39;ichart.finance.yahoo.com&#39;, port=80): Max retries exceeded with url: /table.csv?s=AAPL&amp;a=0&amp;b=1&amp;c=2010&amp;d=6&amp;e=24&amp;f=2017&amp;g=d&amp;ignore=.csv (Caused by NewConnectionError(&#39;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5C59B0&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed&#39;,))

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ConnectionError</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-16-74effd808e23&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span class="ansi-green-intense-fg ansi-bold">def</span> get_px<span class="ansi-yellow-intense-fg ansi-bold">(</span>stock<span class="ansi-yellow-intense-fg ansi-bold">,</span> start<span class="ansi-yellow-intense-fg ansi-bold">,</span> end<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-green-intense-fg ansi-bold">return</span> web<span class="ansi-yellow-intense-fg ansi-bold">.</span>DataReader<span class="ansi-yellow-intense-fg ansi-bold">(</span>stock<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;yahoo&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>start<span class="ansi-yellow-intense-fg ansi-bold">,</span> end<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>px <span class="ansi-yellow-intense-fg ansi-bold">=</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">{</span>n<span class="ansi-yellow-intense-fg ansi-bold">:</span> get_px<span class="ansi-yellow-intense-fg ansi-bold">(</span>n<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">for</span> n <span class="ansi-green-intense-fg ansi-bold">in</span> names<span class="ansi-yellow-intense-fg ansi-bold">}</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> 
<span class="ansi-green-intense-fg ansi-bold">      9</span> <span class="ansi-red-intense-fg ansi-bold">#px = pd.read_csv(&#39;data/ch11/stock_px.csv&#39;)</span>

<span class="ansi-green-fg">&lt;ipython-input-16-74effd808e23&gt;</span> in <span class="ansi-cyan-fg">&lt;dictcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span class="ansi-green-intense-fg ansi-bold">def</span> get_px<span class="ansi-yellow-intense-fg ansi-bold">(</span>stock<span class="ansi-yellow-intense-fg ansi-bold">,</span> start<span class="ansi-yellow-intense-fg ansi-bold">,</span> end<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-green-intense-fg ansi-bold">return</span> web<span class="ansi-yellow-intense-fg ansi-bold">.</span>DataReader<span class="ansi-yellow-intense-fg ansi-bold">(</span>stock<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;yahoo&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>start<span class="ansi-yellow-intense-fg ansi-bold">,</span> end<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>px <span class="ansi-yellow-intense-fg ansi-bold">=</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">{</span>n<span class="ansi-yellow-intense-fg ansi-bold">:</span> get_px<span class="ansi-yellow-intense-fg ansi-bold">(</span>n<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">for</span> n <span class="ansi-green-intense-fg ansi-bold">in</span> names<span class="ansi-yellow-intense-fg ansi-bold">}</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> 
<span class="ansi-green-intense-fg ansi-bold">      9</span> <span class="ansi-red-intense-fg ansi-bold">#px = pd.read_csv(&#39;data/ch11/stock_px.csv&#39;)</span>

<span class="ansi-green-fg">&lt;ipython-input-16-74effd808e23&gt;</span> in <span class="ansi-cyan-fg">get_px</span><span class="ansi-blue-fg">(stock, start, end)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> names <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;AAPL&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;GOOG&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;MSFT&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;DELL&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;GS&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;MS&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;BAC&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;C&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span class="ansi-green-intense-fg ansi-bold">def</span> get_px<span class="ansi-yellow-intense-fg ansi-bold">(</span>stock<span class="ansi-yellow-intense-fg ansi-bold">,</span> start<span class="ansi-yellow-intense-fg ansi-bold">,</span> end<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">return</span> web<span class="ansi-yellow-intense-fg ansi-bold">.</span>DataReader<span class="ansi-yellow-intense-fg ansi-bold">(</span>stock<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;yahoo&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>start<span class="ansi-yellow-intense-fg ansi-bold">,</span> end<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> px <span class="ansi-yellow-intense-fg ansi-bold">=</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">{</span>n<span class="ansi-yellow-intense-fg ansi-bold">:</span> get_px<span class="ansi-yellow-intense-fg ansi-bold">(</span>n<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">for</span> n <span class="ansi-green-intense-fg ansi-bold">in</span> names<span class="ansi-yellow-intense-fg ansi-bold">}</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\data.py</span> in <span class="ansi-cyan-fg">DataReader</span><span class="ansi-blue-fg">(name, data_source, start, end, retry_count, pause, session, access_key)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>                                 adjust_price<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-green-intense-fg ansi-bold">False</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> chunksize<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">25</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>                                 retry_count<span class="ansi-yellow-intense-fg ansi-bold">=</span>retry_count<span class="ansi-yellow-intense-fg ansi-bold">,</span> pause<span class="ansi-yellow-intense-fg ansi-bold">=</span>pause<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-fg">                                 session=session).read()
</span><span class="ansi-green-intense-fg ansi-bold">    118</span> 
<span class="ansi-green-intense-fg ansi-bold">    119</span>     <span class="ansi-green-intense-fg ansi-bold">elif</span> data_source <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#34;yahoo-actions&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\yahoo\daily.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> read<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34; read one data from specified URL &#34;&#34;&#34;</span>
<span class="ansi-green-fg">---&gt; 77</span><span class="ansi-red-fg">         </span>df <span class="ansi-yellow-intense-fg ansi-bold">=</span> super<span class="ansi-yellow-intense-fg ansi-bold">(</span>YahooDailyReader<span class="ansi-yellow-intense-fg ansi-bold">,</span> self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>read<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>ret_index<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>             df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Ret_Index&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> _calc_return_index<span class="ansi-yellow-intense-fg ansi-bold">(</span>df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    155</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>symbols<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span>compat<span class="ansi-yellow-intense-fg ansi-bold">.</span>string_types<span class="ansi-yellow-intense-fg ansi-bold">,</span> int<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>             df = self._read_one_data(self.url,
<span class="ansi-green-fg">--&gt; 157</span><span class="ansi-red-fg">                                      params=self._get_params(self.symbols))
</span><span class="ansi-green-intense-fg ansi-bold">    158</span>         <span class="ansi-red-intense-fg ansi-bold"># Or multiple symbols, (e.g., [&#39;GOOG&#39;, &#39;AAPL&#39;, &#39;MSFT&#39;])</span>
<span class="ansi-green-intense-fg ansi-bold">    159</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>symbols<span class="ansi-yellow-intense-fg ansi-bold">,</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_read_one_data</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     72</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34; read one data from specified URL &#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_format <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;string&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">---&gt; 74</span><span class="ansi-red-fg">             </span>out <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_read_url_as_StringIO<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_format <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;json&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>             out <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_get_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>json<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_read_url_as_StringIO</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>         Open url <span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-green-intense-fg ansi-bold">and</span> retry<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">---&gt; 85</span><span class="ansi-red-fg">         </span>response <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_get_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     86</span>         text <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_sanitize_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>response<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     87</span>         out <span class="ansi-yellow-intense-fg ansi-bold">=</span> StringIO<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_get_response</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    112</span>         <span class="ansi-red-intense-fg ansi-bold"># initial attempt + retry</span>
<span class="ansi-green-intense-fg ansi-bold">    113</span>         <span class="ansi-green-intense-fg ansi-bold">for</span> i <span class="ansi-green-intense-fg ansi-bold">in</span> range<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>retry_count <span class="ansi-yellow-intense-fg ansi-bold">+</span> <span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 114</span><span class="ansi-red-fg">             </span>response <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>session<span class="ansi-yellow-intense-fg ansi-bold">.</span>get<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> response<span class="ansi-yellow-intense-fg ansi-bold">.</span>status_code <span class="ansi-yellow-intense-fg ansi-bold">==</span> requests<span class="ansi-yellow-intense-fg ansi-bold">.</span>codes<span class="ansi-yellow-intense-fg ansi-bold">.</span>ok<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>                 <span class="ansi-green-intense-fg ansi-bold">return</span> response

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(self, url, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    499</span> 
<span class="ansi-green-intense-fg ansi-bold">    500</span>         kwargs<span class="ansi-yellow-intense-fg ansi-bold">.</span>setdefault<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;allow_redirects&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">True</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">--&gt; 501</span><span class="ansi-red-fg">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>request<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;GET&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    502</span> 
<span class="ansi-green-intense-fg ansi-bold">    503</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> options<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="ansi-green-intense-fg ansi-bold">    486</span>         }
<span class="ansi-green-intense-fg ansi-bold">    487</span>         send_kwargs<span class="ansi-yellow-intense-fg ansi-bold">.</span>update<span class="ansi-yellow-intense-fg ansi-bold">(</span>settings<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">--&gt; 488</span><span class="ansi-red-fg">         </span>resp <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>prep<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>send_kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    489</span> 
<span class="ansi-green-intense-fg ansi-bold">    490</span>         <span class="ansi-green-intense-fg ansi-bold">return</span> resp

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    607</span> 
<span class="ansi-green-intense-fg ansi-bold">    608</span>         <span class="ansi-red-intense-fg ansi-bold"># Send the request</span>
<span class="ansi-green-fg">--&gt; 609</span><span class="ansi-red-fg">         </span>r <span class="ansi-yellow-intense-fg ansi-bold">=</span> adapter<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>request<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    610</span> 
<span class="ansi-green-intense-fg ansi-bold">    611</span>         <span class="ansi-red-intense-fg ansi-bold"># Total elapsed time of the request (approximately)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    485</span>                 <span class="ansi-green-intense-fg ansi-bold">raise</span> ProxyError<span class="ansi-yellow-intense-fg ansi-bold">(</span>e<span class="ansi-yellow-intense-fg ansi-bold">,</span> request<span class="ansi-yellow-intense-fg ansi-bold">=</span>request<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    486</span> 
<span class="ansi-green-fg">--&gt; 487</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">raise</span> ConnectionError<span class="ansi-yellow-intense-fg ansi-bold">(</span>e<span class="ansi-yellow-intense-fg ansi-bold">,</span> request<span class="ansi-yellow-intense-fg ansi-bold">=</span>request<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    488</span> 
<span class="ansi-green-intense-fg ansi-bold">    489</span>         <span class="ansi-green-intense-fg ansi-bold">except</span> ClosedPoolError <span class="ansi-green-intense-fg ansi-bold">as</span> e<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-red-fg">ConnectionError</span>: HTTPConnectionPool(host=&#39;ichart.finance.yahoo.com&#39;, port=80): Max retries exceeded with url: /table.csv?s=AAPL&amp;a=0&amp;b=1&amp;c=2010&amp;d=6&amp;e=24&amp;f=2017&amp;g=d&amp;ignore=.csv (Caused by NewConnectionError(&#39;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5C59B0&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed&#39;,))</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 绘制每只股票的累计收益</span>
<span class="n">px</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pad&#39;</span><span class="p">)</span>
<span class="n">rets</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rets</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\ProgramData\Anaconda3\lib\site-packages\pandas\tseries\index.py:506: UserWarning: Discarding nonzero nanoseconds in conversion
  index = _generate_regular_range(start, end, periods, offset)
C:\ProgramData\Anaconda3\lib\site-packages\matplotlib\axes\_base.py:2903: UserWarning: Attempting to set identical left==right results
in singular transformations; automatically expanding.
left=0.0, right=0.0
  &#39;left=%s, right=%s&#39;) % (left, right))
</pre>
</div>
</div>

<div class="output_area"><div class="prompt output_prompt">Out[4]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0xa12feb8&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 对于投资组合的构建，计算特定回顾期的动量，然后按降序排列，并标准化</span>
<span class="k">def</span> <span class="nf">calc_mom</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="n">lag</span><span class="p">):</span>
    <span class="n">mom_ret</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">lookback</span><span class="p">)</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="n">mom_ret</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">demeaned</span> <span class="o">=</span> <span class="n">ranks</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ranks</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">demeaned</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">demeaned</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 编写检验函数，计算夏普比率</span>
<span class="n">compound</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">daily_sr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">strat_sr</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">hold</span><span class="p">):</span>
    <span class="c1"># Compute portfolio weights</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">B&#39;</span> <span class="o">%</span> <span class="n">hold</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">calc_mom</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">daily_rets</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>

    <span class="c1"># 计算投资组合收益</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="n">daily_rets</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">compound</span><span class="p">)</span>
    <span class="n">port_rets</span> <span class="o">=</span> <span class="p">(</span><span class="n">port</span> <span class="o">*</span> <span class="n">returns</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">daily_sr</span><span class="p">(</span><span class="n">port_rets</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span> <span class="o">/</span> <span class="n">hold</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 得到一个标量值</span>
<span class="n">strat_sr</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\ops.py</span> in <span class="ansi-cyan-fg">na_op</span><span class="ansi-blue-fg">(x, y)</span>
<span class="ansi-green-intense-fg ansi-bold">   1169</span>             result = expressions.evaluate(op, str_rep, x, y,
<span class="ansi-green-fg">-&gt; 1170</span><span class="ansi-red-fg">                                           raise_on_error=True, **eval_kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">   1171</span>         <span class="ansi-green-intense-fg ansi-bold">except</span> TypeError<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\computation\expressions.py</span> in <span class="ansi-cyan-fg">evaluate</span><span class="ansi-blue-fg">(op, op_str, a, b, raise_on_error, use_numexpr, **eval_kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    209</span>         return _evaluate(op, op_str, a, b, raise_on_error=raise_on_error,
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">                          **eval_kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">    211</span>     <span class="ansi-green-intense-fg ansi-bold">return</span> _evaluate_standard<span class="ansi-yellow-intense-fg ansi-bold">(</span>op<span class="ansi-yellow-intense-fg ansi-bold">,</span> op_str<span class="ansi-yellow-intense-fg ansi-bold">,</span> a<span class="ansi-yellow-intense-fg ansi-bold">,</span> b<span class="ansi-yellow-intense-fg ansi-bold">,</span> raise_on_error<span class="ansi-yellow-intense-fg ansi-bold">=</span>raise_on_error<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\computation\expressions.py</span> in <span class="ansi-cyan-fg">_evaluate_numexpr</span><span class="ansi-blue-fg">(op, op_str, a, b, raise_on_error, truediv, reversed, **eval_kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    120</span>     <span class="ansi-green-intense-fg ansi-bold">if</span> result <span class="ansi-green-intense-fg ansi-bold">is</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 121</span><span class="ansi-red-fg">         </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> _evaluate_standard<span class="ansi-yellow-intense-fg ansi-bold">(</span>op<span class="ansi-yellow-intense-fg ansi-bold">,</span> op_str<span class="ansi-yellow-intense-fg ansi-bold">,</span> a<span class="ansi-yellow-intense-fg ansi-bold">,</span> b<span class="ansi-yellow-intense-fg ansi-bold">,</span> raise_on_error<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    122</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\computation\expressions.py</span> in <span class="ansi-cyan-fg">_evaluate_standard</span><span class="ansi-blue-fg">(op, op_str, a, b, raise_on_error, **eval_kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     62</span>     <span class="ansi-green-intense-fg ansi-bold">with</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>errstate<span class="ansi-yellow-intense-fg ansi-bold">(</span>all<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;ignore&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">---&gt; 63</span><span class="ansi-red-fg">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> op<span class="ansi-yellow-intense-fg ansi-bold">(</span>a<span class="ansi-yellow-intense-fg ansi-bold">,</span> b<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     64</span> 

<span class="ansi-red-fg">TypeError</span>: unsupported operand type(s) for /: &#39;str&#39; and &#39;float&#39;

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-11-f56a8482ef9f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 得到一个标量值</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>strat_sr<span class="ansi-yellow-intense-fg ansi-bold">(</span>px<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">70</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">30</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">&lt;ipython-input-8-46ba12b4e341&gt;</span> in <span class="ansi-cyan-fg">strat_sr</span><span class="ansi-blue-fg">(prices, lb, hold)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-red-intense-fg ansi-bold"># Compute portfolio weights</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     freq <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;%dB&#39;</span> <span class="ansi-yellow-intense-fg ansi-bold">%</span> hold
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg">     </span>port <span class="ansi-yellow-intense-fg ansi-bold">=</span> calc_mom<span class="ansi-yellow-intense-fg ansi-bold">(</span>prices<span class="ansi-yellow-intense-fg ansi-bold">,</span> lb<span class="ansi-yellow-intense-fg ansi-bold">,</span> lag<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span> 
<span class="ansi-green-intense-fg ansi-bold">     10</span>     daily_rets <span class="ansi-yellow-intense-fg ansi-bold">=</span> prices<span class="ansi-yellow-intense-fg ansi-bold">.</span>pct_change<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">&lt;ipython-input-7-a52d117a5e26&gt;</span> in <span class="ansi-cyan-fg">calc_mom</span><span class="ansi-blue-fg">(price, lookback, lag)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 对于投资组合的构建，计算特定回顾期的动量，然后按降序排列，并标准化</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-intense-fg ansi-bold">def</span> calc_mom<span class="ansi-yellow-intense-fg ansi-bold">(</span>price<span class="ansi-yellow-intense-fg ansi-bold">,</span> lookback<span class="ansi-yellow-intense-fg ansi-bold">,</span> lag<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">     </span>mom_ret <span class="ansi-yellow-intense-fg ansi-bold">=</span> price<span class="ansi-yellow-intense-fg ansi-bold">.</span>shift<span class="ansi-yellow-intense-fg ansi-bold">(</span>lag<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>pct_change<span class="ansi-yellow-intense-fg ansi-bold">(</span>lookback<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     ranks <span class="ansi-yellow-intense-fg ansi-bold">=</span> mom_ret<span class="ansi-yellow-intense-fg ansi-bold">.</span>rank<span class="ansi-yellow-intense-fg ansi-bold">(</span>axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> ascending<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-green-intense-fg ansi-bold">False</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     demeaned <span class="ansi-yellow-intense-fg ansi-bold">=</span> ranks<span class="ansi-yellow-intense-fg ansi-bold">.</span>subtract<span class="ansi-yellow-intense-fg ansi-bold">(</span>ranks<span class="ansi-yellow-intense-fg ansi-bold">.</span>mean<span class="ansi-yellow-intense-fg ansi-bold">(</span>axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\generic.py</span> in <span class="ansi-cyan-fg">pct_change</span><span class="ansi-blue-fg">(self, periods, fill_method, limit, freq, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   5330</span> 
<span class="ansi-green-intense-fg ansi-bold">   5331</span>         rs = (data.div(data.shift(periods=periods, freq=freq, axis=axis,
<span class="ansi-green-fg">-&gt; 5332</span><span class="ansi-red-fg">                                   **kwargs)) - 1)
</span><span class="ansi-green-intense-fg ansi-bold">   5333</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> freq <span class="ansi-green-intense-fg ansi-bold">is</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   5334</span>             mask <span class="ansi-yellow-intense-fg ansi-bold">=</span> isnull<span class="ansi-yellow-intense-fg ansi-bold">(</span>_values_from_object<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\ops.py</span> in <span class="ansi-cyan-fg">f</span><span class="ansi-blue-fg">(self, other, axis, level, fill_value)</span>
<span class="ansi-green-intense-fg ansi-bold">   1226</span> 
<span class="ansi-green-intense-fg ansi-bold">   1227</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>DataFrame<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>  <span class="ansi-red-intense-fg ansi-bold"># Another DataFrame</span>
<span class="ansi-green-fg">-&gt; 1228</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_combine_frame<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> na_op<span class="ansi-yellow-intense-fg ansi-bold">,</span> fill_value<span class="ansi-yellow-intense-fg ansi-bold">,</span> level<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1229</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> ABCSeries<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1230</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_combine_series<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> na_op<span class="ansi-yellow-intense-fg ansi-bold">,</span> fill_value<span class="ansi-yellow-intense-fg ansi-bold">,</span> axis<span class="ansi-yellow-intense-fg ansi-bold">,</span> level<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">_combine_frame</span><span class="ansi-blue-fg">(self, other, func, fill_value, level)</span>
<span class="ansi-green-intense-fg ansi-bold">   3548</span>                                                     dtype=r.dtype)
<span class="ansi-green-intense-fg ansi-bold">   3549</span> 
<span class="ansi-green-fg">-&gt; 3550</span><span class="ansi-red-fg">                 </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> dict<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">,</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">for</span> col <span class="ansi-green-intense-fg ansi-bold">in</span> this<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3551</span> 
<span class="ansi-green-intense-fg ansi-bold">   3552</span>             <span class="ansi-red-intense-fg ansi-bold"># non-unique</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">   3548</span>                                                     dtype=r.dtype)
<span class="ansi-green-intense-fg ansi-bold">   3549</span> 
<span class="ansi-green-fg">-&gt; 3550</span><span class="ansi-red-fg">                 </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> dict<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">,</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">for</span> col <span class="ansi-green-intense-fg ansi-bold">in</span> this<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3551</span> 
<span class="ansi-green-intense-fg ansi-bold">   3552</span>             <span class="ansi-red-intense-fg ansi-bold"># non-unique</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">f</span><span class="ansi-blue-fg">(col)</span>
<span class="ansi-green-intense-fg ansi-bold">   3544</span> 
<span class="ansi-green-intense-fg ansi-bold">   3545</span>                 <span class="ansi-green-intense-fg ansi-bold">def</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">-&gt; 3546</span><span class="ansi-red-fg">                     </span>r <span class="ansi-yellow-intense-fg ansi-bold">=</span> _arith_op<span class="ansi-yellow-intense-fg ansi-bold">(</span>this<span class="ansi-yellow-intense-fg ansi-bold">[</span>col<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">,</span> other<span class="ansi-yellow-intense-fg ansi-bold">[</span>col<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3547</span>                     return self._constructor_sliced(r, index=new_index,
<span class="ansi-green-intense-fg ansi-bold">   3548</span>                                                     dtype=r.dtype)

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">_arith_op</span><span class="ansi-blue-fg">(left, right)</span>
<span class="ansi-green-intense-fg ansi-bold">   3536</span>                 right<span class="ansi-yellow-intense-fg ansi-bold">[</span>right_mask <span class="ansi-yellow-intense-fg ansi-bold">&amp;</span> mask<span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> fill_value
<span class="ansi-green-intense-fg ansi-bold">   3537</span> 
<span class="ansi-green-fg">-&gt; 3538</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">return</span> func<span class="ansi-yellow-intense-fg ansi-bold">(</span>left<span class="ansi-yellow-intense-fg ansi-bold">,</span> right<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3539</span> 
<span class="ansi-green-intense-fg ansi-bold">   3540</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> this<span class="ansi-yellow-intense-fg ansi-bold">.</span>_is_mixed_type <span class="ansi-green-intense-fg ansi-bold">or</span> other<span class="ansi-yellow-intense-fg ansi-bold">.</span>_is_mixed_type<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\ops.py</span> in <span class="ansi-cyan-fg">na_op</span><span class="ansi-blue-fg">(x, y)</span>
<span class="ansi-green-intense-fg ansi-bold">   1187</span>                 <span class="ansi-green-intense-fg ansi-bold">if</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>prod<span class="ansi-yellow-intense-fg ansi-bold">(</span>xrav<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">and</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>prod<span class="ansi-yellow-intense-fg ansi-bold">(</span>yrav<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1188</span>                     <span class="ansi-green-intense-fg ansi-bold">with</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>errstate<span class="ansi-yellow-intense-fg ansi-bold">(</span>all<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;ignore&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">-&gt; 1189</span><span class="ansi-red-fg">                         </span>result<span class="ansi-yellow-intense-fg ansi-bold">[</span>mask<span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> op<span class="ansi-yellow-intense-fg ansi-bold">(</span>xrav<span class="ansi-yellow-intense-fg ansi-bold">,</span> yrav<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1190</span>             <span class="ansi-green-intense-fg ansi-bold">elif</span> hasattr<span class="ansi-yellow-intense-fg ansi-bold">(</span>x<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;size&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1191</span>                 result <span class="ansi-yellow-intense-fg ansi-bold">=</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>empty<span class="ansi-yellow-intense-fg ansi-bold">(</span>x<span class="ansi-yellow-intense-fg ansi-bold">.</span>size<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype<span class="ansi-yellow-intense-fg ansi-bold">=</span>x<span class="ansi-yellow-intense-fg ansi-bold">.</span>dtype<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">TypeError</span>: unsupported operand type(s) for /: &#39;str&#39; and &#39;str&#39;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 对参数网格（多对参数组合）应用strat_sr函数，结果报出到defaultdict中</span>
<span class="c1"># 最后将全部结果放到DataFrame</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>

<span class="n">lookbacks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">holdings</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">lookbacks</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">hold</span> <span class="ow">in</span> <span class="n">holdings</span><span class="p">:</span>
        <span class="n">dd</span><span class="p">[</span><span class="n">lb</span><span class="p">][</span><span class="n">hold</span><span class="p">]</span> <span class="o">=</span> <span class="n">strat_sr</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">hold</span><span class="p">)</span>

<span class="n">ddf</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
<span class="n">ddf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Holding Period&#39;</span>
<span class="n">ddf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Lookback Period&#39;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\ops.py</span> in <span class="ansi-cyan-fg">na_op</span><span class="ansi-blue-fg">(x, y)</span>
<span class="ansi-green-intense-fg ansi-bold">   1169</span>             result = expressions.evaluate(op, str_rep, x, y,
<span class="ansi-green-fg">-&gt; 1170</span><span class="ansi-red-fg">                                           raise_on_error=True, **eval_kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">   1171</span>         <span class="ansi-green-intense-fg ansi-bold">except</span> TypeError<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\computation\expressions.py</span> in <span class="ansi-cyan-fg">evaluate</span><span class="ansi-blue-fg">(op, op_str, a, b, raise_on_error, use_numexpr, **eval_kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    209</span>         return _evaluate(op, op_str, a, b, raise_on_error=raise_on_error,
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">                          **eval_kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">    211</span>     <span class="ansi-green-intense-fg ansi-bold">return</span> _evaluate_standard<span class="ansi-yellow-intense-fg ansi-bold">(</span>op<span class="ansi-yellow-intense-fg ansi-bold">,</span> op_str<span class="ansi-yellow-intense-fg ansi-bold">,</span> a<span class="ansi-yellow-intense-fg ansi-bold">,</span> b<span class="ansi-yellow-intense-fg ansi-bold">,</span> raise_on_error<span class="ansi-yellow-intense-fg ansi-bold">=</span>raise_on_error<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\computation\expressions.py</span> in <span class="ansi-cyan-fg">_evaluate_numexpr</span><span class="ansi-blue-fg">(op, op_str, a, b, raise_on_error, truediv, reversed, **eval_kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    120</span>     <span class="ansi-green-intense-fg ansi-bold">if</span> result <span class="ansi-green-intense-fg ansi-bold">is</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 121</span><span class="ansi-red-fg">         </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> _evaluate_standard<span class="ansi-yellow-intense-fg ansi-bold">(</span>op<span class="ansi-yellow-intense-fg ansi-bold">,</span> op_str<span class="ansi-yellow-intense-fg ansi-bold">,</span> a<span class="ansi-yellow-intense-fg ansi-bold">,</span> b<span class="ansi-yellow-intense-fg ansi-bold">,</span> raise_on_error<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    122</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\computation\expressions.py</span> in <span class="ansi-cyan-fg">_evaluate_standard</span><span class="ansi-blue-fg">(op, op_str, a, b, raise_on_error, **eval_kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     62</span>     <span class="ansi-green-intense-fg ansi-bold">with</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>errstate<span class="ansi-yellow-intense-fg ansi-bold">(</span>all<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;ignore&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">---&gt; 63</span><span class="ansi-red-fg">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> op<span class="ansi-yellow-intense-fg ansi-bold">(</span>a<span class="ansi-yellow-intense-fg ansi-bold">,</span> b<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     64</span> 

<span class="ansi-red-fg">TypeError</span>: unsupported operand type(s) for /: &#39;str&#39; and &#39;float&#39;

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-12-ad29c52e2e4b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> <span class="ansi-green-intense-fg ansi-bold">for</span> lb <span class="ansi-green-intense-fg ansi-bold">in</span> lookbacks<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>     <span class="ansi-green-intense-fg ansi-bold">for</span> hold <span class="ansi-green-intense-fg ansi-bold">in</span> holdings<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">---&gt; 10</span><span class="ansi-red-fg">         </span>dd<span class="ansi-yellow-intense-fg ansi-bold">[</span>lb<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">[</span>hold<span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> strat_sr<span class="ansi-yellow-intense-fg ansi-bold">(</span>px<span class="ansi-yellow-intense-fg ansi-bold">,</span> lb<span class="ansi-yellow-intense-fg ansi-bold">,</span> hold<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span> 
<span class="ansi-green-intense-fg ansi-bold">     12</span> ddf <span class="ansi-yellow-intense-fg ansi-bold">=</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">(</span>dd<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">&lt;ipython-input-8-46ba12b4e341&gt;</span> in <span class="ansi-cyan-fg">strat_sr</span><span class="ansi-blue-fg">(prices, lb, hold)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-red-intense-fg ansi-bold"># Compute portfolio weights</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     freq <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;%dB&#39;</span> <span class="ansi-yellow-intense-fg ansi-bold">%</span> hold
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg">     </span>port <span class="ansi-yellow-intense-fg ansi-bold">=</span> calc_mom<span class="ansi-yellow-intense-fg ansi-bold">(</span>prices<span class="ansi-yellow-intense-fg ansi-bold">,</span> lb<span class="ansi-yellow-intense-fg ansi-bold">,</span> lag<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span> 
<span class="ansi-green-intense-fg ansi-bold">     10</span>     daily_rets <span class="ansi-yellow-intense-fg ansi-bold">=</span> prices<span class="ansi-yellow-intense-fg ansi-bold">.</span>pct_change<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">&lt;ipython-input-7-a52d117a5e26&gt;</span> in <span class="ansi-cyan-fg">calc_mom</span><span class="ansi-blue-fg">(price, lookback, lag)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 对于投资组合的构建，计算特定回顾期的动量，然后按降序排列，并标准化</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-intense-fg ansi-bold">def</span> calc_mom<span class="ansi-yellow-intense-fg ansi-bold">(</span>price<span class="ansi-yellow-intense-fg ansi-bold">,</span> lookback<span class="ansi-yellow-intense-fg ansi-bold">,</span> lag<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">     </span>mom_ret <span class="ansi-yellow-intense-fg ansi-bold">=</span> price<span class="ansi-yellow-intense-fg ansi-bold">.</span>shift<span class="ansi-yellow-intense-fg ansi-bold">(</span>lag<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>pct_change<span class="ansi-yellow-intense-fg ansi-bold">(</span>lookback<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     ranks <span class="ansi-yellow-intense-fg ansi-bold">=</span> mom_ret<span class="ansi-yellow-intense-fg ansi-bold">.</span>rank<span class="ansi-yellow-intense-fg ansi-bold">(</span>axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> ascending<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-green-intense-fg ansi-bold">False</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     demeaned <span class="ansi-yellow-intense-fg ansi-bold">=</span> ranks<span class="ansi-yellow-intense-fg ansi-bold">.</span>subtract<span class="ansi-yellow-intense-fg ansi-bold">(</span>ranks<span class="ansi-yellow-intense-fg ansi-bold">.</span>mean<span class="ansi-yellow-intense-fg ansi-bold">(</span>axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> axis<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\generic.py</span> in <span class="ansi-cyan-fg">pct_change</span><span class="ansi-blue-fg">(self, periods, fill_method, limit, freq, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   5330</span> 
<span class="ansi-green-intense-fg ansi-bold">   5331</span>         rs = (data.div(data.shift(periods=periods, freq=freq, axis=axis,
<span class="ansi-green-fg">-&gt; 5332</span><span class="ansi-red-fg">                                   **kwargs)) - 1)
</span><span class="ansi-green-intense-fg ansi-bold">   5333</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> freq <span class="ansi-green-intense-fg ansi-bold">is</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   5334</span>             mask <span class="ansi-yellow-intense-fg ansi-bold">=</span> isnull<span class="ansi-yellow-intense-fg ansi-bold">(</span>_values_from_object<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\ops.py</span> in <span class="ansi-cyan-fg">f</span><span class="ansi-blue-fg">(self, other, axis, level, fill_value)</span>
<span class="ansi-green-intense-fg ansi-bold">   1226</span> 
<span class="ansi-green-intense-fg ansi-bold">   1227</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>DataFrame<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>  <span class="ansi-red-intense-fg ansi-bold"># Another DataFrame</span>
<span class="ansi-green-fg">-&gt; 1228</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_combine_frame<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> na_op<span class="ansi-yellow-intense-fg ansi-bold">,</span> fill_value<span class="ansi-yellow-intense-fg ansi-bold">,</span> level<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1229</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> ABCSeries<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1230</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_combine_series<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> na_op<span class="ansi-yellow-intense-fg ansi-bold">,</span> fill_value<span class="ansi-yellow-intense-fg ansi-bold">,</span> axis<span class="ansi-yellow-intense-fg ansi-bold">,</span> level<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">_combine_frame</span><span class="ansi-blue-fg">(self, other, func, fill_value, level)</span>
<span class="ansi-green-intense-fg ansi-bold">   3548</span>                                                     dtype=r.dtype)
<span class="ansi-green-intense-fg ansi-bold">   3549</span> 
<span class="ansi-green-fg">-&gt; 3550</span><span class="ansi-red-fg">                 </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> dict<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">,</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">for</span> col <span class="ansi-green-intense-fg ansi-bold">in</span> this<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3551</span> 
<span class="ansi-green-intense-fg ansi-bold">   3552</span>             <span class="ansi-red-intense-fg ansi-bold"># non-unique</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">   3548</span>                                                     dtype=r.dtype)
<span class="ansi-green-intense-fg ansi-bold">   3549</span> 
<span class="ansi-green-fg">-&gt; 3550</span><span class="ansi-red-fg">                 </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> dict<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">,</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">for</span> col <span class="ansi-green-intense-fg ansi-bold">in</span> this<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3551</span> 
<span class="ansi-green-intense-fg ansi-bold">   3552</span>             <span class="ansi-red-intense-fg ansi-bold"># non-unique</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">f</span><span class="ansi-blue-fg">(col)</span>
<span class="ansi-green-intense-fg ansi-bold">   3544</span> 
<span class="ansi-green-intense-fg ansi-bold">   3545</span>                 <span class="ansi-green-intense-fg ansi-bold">def</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span>col<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">-&gt; 3546</span><span class="ansi-red-fg">                     </span>r <span class="ansi-yellow-intense-fg ansi-bold">=</span> _arith_op<span class="ansi-yellow-intense-fg ansi-bold">(</span>this<span class="ansi-yellow-intense-fg ansi-bold">[</span>col<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">,</span> other<span class="ansi-yellow-intense-fg ansi-bold">[</span>col<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3547</span>                     return self._constructor_sliced(r, index=new_index,
<span class="ansi-green-intense-fg ansi-bold">   3548</span>                                                     dtype=r.dtype)

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\frame.py</span> in <span class="ansi-cyan-fg">_arith_op</span><span class="ansi-blue-fg">(left, right)</span>
<span class="ansi-green-intense-fg ansi-bold">   3536</span>                 right<span class="ansi-yellow-intense-fg ansi-bold">[</span>right_mask <span class="ansi-yellow-intense-fg ansi-bold">&amp;</span> mask<span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> fill_value
<span class="ansi-green-intense-fg ansi-bold">   3537</span> 
<span class="ansi-green-fg">-&gt; 3538</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">return</span> func<span class="ansi-yellow-intense-fg ansi-bold">(</span>left<span class="ansi-yellow-intense-fg ansi-bold">,</span> right<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   3539</span> 
<span class="ansi-green-intense-fg ansi-bold">   3540</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> this<span class="ansi-yellow-intense-fg ansi-bold">.</span>_is_mixed_type <span class="ansi-green-intense-fg ansi-bold">or</span> other<span class="ansi-yellow-intense-fg ansi-bold">.</span>_is_mixed_type<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas\core\ops.py</span> in <span class="ansi-cyan-fg">na_op</span><span class="ansi-blue-fg">(x, y)</span>
<span class="ansi-green-intense-fg ansi-bold">   1187</span>                 <span class="ansi-green-intense-fg ansi-bold">if</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>prod<span class="ansi-yellow-intense-fg ansi-bold">(</span>xrav<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">and</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>prod<span class="ansi-yellow-intense-fg ansi-bold">(</span>yrav<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1188</span>                     <span class="ansi-green-intense-fg ansi-bold">with</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>errstate<span class="ansi-yellow-intense-fg ansi-bold">(</span>all<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;ignore&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">-&gt; 1189</span><span class="ansi-red-fg">                         </span>result<span class="ansi-yellow-intense-fg ansi-bold">[</span>mask<span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> op<span class="ansi-yellow-intense-fg ansi-bold">(</span>xrav<span class="ansi-yellow-intense-fg ansi-bold">,</span> yrav<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1190</span>             <span class="ansi-green-intense-fg ansi-bold">elif</span> hasattr<span class="ansi-yellow-intense-fg ansi-bold">(</span>x<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;size&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1191</span>                 result <span class="ansi-yellow-intense-fg ansi-bold">=</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>empty<span class="ansi-yellow-intense-fg ansi-bold">(</span>x<span class="ansi-yellow-intense-fg ansi-bold">.</span>size<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype<span class="ansi-yellow-intense-fg ansi-bold">=</span>x<span class="ansi-yellow-intense-fg ansi-bold">.</span>dtype<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">TypeError</span>: unsupported operand type(s) for /: &#39;str&#39; and &#39;str&#39;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 生成热力图</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">axim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axim</span><span class="p">)</span>
<span class="n">heatmap</span><span class="p">(</span><span class="n">ddf</span><span class="p">)</span>    
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-13-9a253bc5a17b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span>     ax<span class="ansi-yellow-intense-fg ansi-bold">.</span>set_yticklabels<span class="ansi-yellow-intense-fg ansi-bold">(</span>list<span class="ansi-yellow-intense-fg ansi-bold">(</span>df<span class="ansi-yellow-intense-fg ansi-bold">.</span>index<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span>     plt<span class="ansi-yellow-intense-fg ansi-bold">.</span>colorbar<span class="ansi-yellow-intense-fg ansi-bold">(</span>axim<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">---&gt; 16</span><span class="ansi-red-fg"> </span>heatmap<span class="ansi-yellow-intense-fg ansi-bold">(</span>ddf<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ddf&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#26399;&#36135;&#21512;&#32422;&#36716;&#20179;">&#26399;&#36135;&#21512;&#32422;&#36716;&#20179;<a class="anchor-link" href="#&#26399;&#36135;&#21512;&#32422;&#36716;&#20179;">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>
<span class="n">px</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;SPY&#39;</span><span class="p">,</span> <span class="s1">&#39;yahoo&#39;</span><span class="p">)[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>
<span class="c1">#px = web.get_data_yahoo(&#39;&#39;)[&#39;Adj Close&#39;] * 10</span>
<span class="n">px</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">gaierror</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">_new_conn</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>             conn = connection.create_connection(
<span class="ansi-green-fg">--&gt; 138</span><span class="ansi-red-fg">                 (self.host, self.port), self.timeout, **extra_kw)
</span><span class="ansi-green-intense-fg ansi-bold">    139</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\util\connection.py</span> in <span class="ansi-cyan-fg">create_connection</span><span class="ansi-blue-fg">(address, timeout, source_address, socket_options)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 
<span class="ansi-green-fg">---&gt; 75</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">for</span> res <span class="ansi-green-intense-fg ansi-bold">in</span> socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>getaddrinfo<span class="ansi-yellow-intense-fg ansi-bold">(</span>host<span class="ansi-yellow-intense-fg ansi-bold">,</span> port<span class="ansi-yellow-intense-fg ansi-bold">,</span> family<span class="ansi-yellow-intense-fg ansi-bold">,</span> socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>SOCK_STREAM<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         af<span class="ansi-yellow-intense-fg ansi-bold">,</span> socktype<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> canonname<span class="ansi-yellow-intense-fg ansi-bold">,</span> sa <span class="ansi-yellow-intense-fg ansi-bold">=</span> res

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\socket.py</span> in <span class="ansi-cyan-fg">getaddrinfo</span><span class="ansi-blue-fg">(host, port, family, type, proto, flags)</span>
<span class="ansi-green-intense-fg ansi-bold">    742</span>     addrlist <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">--&gt; 743</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">for</span> res <span class="ansi-green-intense-fg ansi-bold">in</span> _socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>getaddrinfo<span class="ansi-yellow-intense-fg ansi-bold">(</span>host<span class="ansi-yellow-intense-fg ansi-bold">,</span> port<span class="ansi-yellow-intense-fg ansi-bold">,</span> family<span class="ansi-yellow-intense-fg ansi-bold">,</span> type<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> flags<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    744</span>         af<span class="ansi-yellow-intense-fg ansi-bold">,</span> socktype<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> canonname<span class="ansi-yellow-intense-fg ansi-bold">,</span> sa <span class="ansi-yellow-intense-fg ansi-bold">=</span> res

<span class="ansi-red-fg">gaierror</span>: [Errno 11004] getaddrinfo failed

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">NewConnectionError</span>                        Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    593</span>                                                   body<span class="ansi-yellow-intense-fg ansi-bold">=</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> headers<span class="ansi-yellow-intense-fg ansi-bold">=</span>headers<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 594</span><span class="ansi-red-fg">                                                   chunked=chunked)
</span><span class="ansi-green-intense-fg ansi-bold">    595</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    360</span>         <span class="ansi-green-intense-fg ansi-bold">else</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 361</span><span class="ansi-red-fg">             </span>conn<span class="ansi-yellow-intense-fg ansi-bold">.</span>request<span class="ansi-yellow-intense-fg ansi-bold">(</span>method<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>httplib_request_kw<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    362</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, body, headers, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1238</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34;Send a complete request to the server.&#34;&#34;&#34;</span>
<span class="ansi-green-fg">-&gt; 1239</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_send_request<span class="ansi-yellow-intense-fg ansi-bold">(</span>method<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> body<span class="ansi-yellow-intense-fg ansi-bold">,</span> headers<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1240</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">_send_request</span><span class="ansi-blue-fg">(self, method, url, body, headers, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1284</span>             body <span class="ansi-yellow-intense-fg ansi-bold">=</span> _encode<span class="ansi-yellow-intense-fg ansi-bold">(</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;body&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">-&gt; 1285</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>endheaders<span class="ansi-yellow-intense-fg ansi-bold">(</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">=</span>encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1286</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">endheaders</span><span class="ansi-blue-fg">(self, message_body, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1233</span>             <span class="ansi-green-intense-fg ansi-bold">raise</span> CannotSendHeader<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">-&gt; 1234</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_send_output<span class="ansi-yellow-intense-fg ansi-bold">(</span>message_body<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">=</span>encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1235</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">_send_output</span><span class="ansi-blue-fg">(self, message_body, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1025</span>         <span class="ansi-green-intense-fg ansi-bold">del</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_buffer<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">:</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">-&gt; 1026</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>msg<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1027</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, data)</span>
<span class="ansi-green-intense-fg ansi-bold">    963</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>auto_open<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 964</span><span class="ansi-red-fg">                 </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>connect<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    965</span>             <span class="ansi-green-intense-fg ansi-bold">else</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">connect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    162</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> connect<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 163</span><span class="ansi-red-fg">         </span>conn <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_new_conn<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    164</span>         self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_prepare_conn<span class="ansi-yellow-intense-fg ansi-bold">(</span>conn<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">_new_conn</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    146</span>             raise NewConnectionError(
<span class="ansi-green-fg">--&gt; 147</span><span class="ansi-red-fg">                 self, &#34;Failed to establish a new connection: %s&#34; % e)
</span><span class="ansi-green-intense-fg ansi-bold">    148</span> 

<span class="ansi-red-fg">NewConnectionError</span>: &lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5E5550&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">MaxRetryError</span>                             Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    422</span>                     retries<span class="ansi-yellow-intense-fg ansi-bold">=</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>max_retries<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 423</span><span class="ansi-red-fg">                     </span>timeout<span class="ansi-yellow-intense-fg ansi-bold">=</span>timeout
<span class="ansi-green-intense-fg ansi-bold">    424</span>                 )

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    642</span>             retries = retries.increment(method, url, error=e, _pool=self,
<span class="ansi-green-fg">--&gt; 643</span><span class="ansi-red-fg">                                         _stacktrace=sys.exc_info()[2])
</span><span class="ansi-green-intense-fg ansi-bold">    644</span>             retries<span class="ansi-yellow-intense-fg ansi-bold">.</span>sleep<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\util\retry.py</span> in <span class="ansi-cyan-fg">increment</span><span class="ansi-blue-fg">(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="ansi-green-intense-fg ansi-bold">    362</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> new_retry<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_exhausted<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 363</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">raise</span> MaxRetryError<span class="ansi-yellow-intense-fg ansi-bold">(</span>_pool<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> error <span class="ansi-green-intense-fg ansi-bold">or</span> ResponseError<span class="ansi-yellow-intense-fg ansi-bold">(</span>cause<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    364</span> 

<span class="ansi-red-fg">MaxRetryError</span>: HTTPConnectionPool(host=&#39;ichart.finance.yahoo.com&#39;, port=80): Max retries exceeded with url: /table.csv?s=SPY&amp;a=0&amp;b=1&amp;c=2010&amp;d=6&amp;e=24&amp;f=2017&amp;g=d&amp;ignore=.csv (Caused by NewConnectionError(&#39;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5E5550&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed&#39;,))

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ConnectionError</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-21-4d516e3238de&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-intense-fg ansi-bold">import</span> pandas_datareader<span class="ansi-yellow-intense-fg ansi-bold">.</span>data <span class="ansi-green-intense-fg ansi-bold">as</span> web
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>px <span class="ansi-yellow-intense-fg ansi-bold">=</span> web<span class="ansi-yellow-intense-fg ansi-bold">.</span>DataReader<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;SPY&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;yahoo&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-red-intense-fg ansi-bold">#px = web.get_data_yahoo(&#39;&#39;)[&#39;Adj Close&#39;] * 10</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> px

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\data.py</span> in <span class="ansi-cyan-fg">DataReader</span><span class="ansi-blue-fg">(name, data_source, start, end, retry_count, pause, session, access_key)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>                                 adjust_price<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-green-intense-fg ansi-bold">False</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> chunksize<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">25</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>                                 retry_count<span class="ansi-yellow-intense-fg ansi-bold">=</span>retry_count<span class="ansi-yellow-intense-fg ansi-bold">,</span> pause<span class="ansi-yellow-intense-fg ansi-bold">=</span>pause<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-fg">                                 session=session).read()
</span><span class="ansi-green-intense-fg ansi-bold">    118</span> 
<span class="ansi-green-intense-fg ansi-bold">    119</span>     <span class="ansi-green-intense-fg ansi-bold">elif</span> data_source <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#34;yahoo-actions&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\yahoo\daily.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> read<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34; read one data from specified URL &#34;&#34;&#34;</span>
<span class="ansi-green-fg">---&gt; 77</span><span class="ansi-red-fg">         </span>df <span class="ansi-yellow-intense-fg ansi-bold">=</span> super<span class="ansi-yellow-intense-fg ansi-bold">(</span>YahooDailyReader<span class="ansi-yellow-intense-fg ansi-bold">,</span> self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>read<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>ret_index<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>             df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Ret_Index&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> _calc_return_index<span class="ansi-yellow-intense-fg ansi-bold">(</span>df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    155</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>symbols<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span>compat<span class="ansi-yellow-intense-fg ansi-bold">.</span>string_types<span class="ansi-yellow-intense-fg ansi-bold">,</span> int<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>             df = self._read_one_data(self.url,
<span class="ansi-green-fg">--&gt; 157</span><span class="ansi-red-fg">                                      params=self._get_params(self.symbols))
</span><span class="ansi-green-intense-fg ansi-bold">    158</span>         <span class="ansi-red-intense-fg ansi-bold"># Or multiple symbols, (e.g., [&#39;GOOG&#39;, &#39;AAPL&#39;, &#39;MSFT&#39;])</span>
<span class="ansi-green-intense-fg ansi-bold">    159</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>symbols<span class="ansi-yellow-intense-fg ansi-bold">,</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_read_one_data</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     72</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34; read one data from specified URL &#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_format <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;string&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">---&gt; 74</span><span class="ansi-red-fg">             </span>out <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_read_url_as_StringIO<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_format <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;json&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>             out <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_get_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>json<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_read_url_as_StringIO</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>         Open url <span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-green-intense-fg ansi-bold">and</span> retry<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">---&gt; 85</span><span class="ansi-red-fg">         </span>response <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_get_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     86</span>         text <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_sanitize_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>response<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     87</span>         out <span class="ansi-yellow-intense-fg ansi-bold">=</span> StringIO<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_get_response</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    112</span>         <span class="ansi-red-intense-fg ansi-bold"># initial attempt + retry</span>
<span class="ansi-green-intense-fg ansi-bold">    113</span>         <span class="ansi-green-intense-fg ansi-bold">for</span> i <span class="ansi-green-intense-fg ansi-bold">in</span> range<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>retry_count <span class="ansi-yellow-intense-fg ansi-bold">+</span> <span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 114</span><span class="ansi-red-fg">             </span>response <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>session<span class="ansi-yellow-intense-fg ansi-bold">.</span>get<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> response<span class="ansi-yellow-intense-fg ansi-bold">.</span>status_code <span class="ansi-yellow-intense-fg ansi-bold">==</span> requests<span class="ansi-yellow-intense-fg ansi-bold">.</span>codes<span class="ansi-yellow-intense-fg ansi-bold">.</span>ok<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>                 <span class="ansi-green-intense-fg ansi-bold">return</span> response

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(self, url, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    499</span> 
<span class="ansi-green-intense-fg ansi-bold">    500</span>         kwargs<span class="ansi-yellow-intense-fg ansi-bold">.</span>setdefault<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;allow_redirects&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">True</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">--&gt; 501</span><span class="ansi-red-fg">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>request<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;GET&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    502</span> 
<span class="ansi-green-intense-fg ansi-bold">    503</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> options<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="ansi-green-intense-fg ansi-bold">    486</span>         }
<span class="ansi-green-intense-fg ansi-bold">    487</span>         send_kwargs<span class="ansi-yellow-intense-fg ansi-bold">.</span>update<span class="ansi-yellow-intense-fg ansi-bold">(</span>settings<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">--&gt; 488</span><span class="ansi-red-fg">         </span>resp <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>prep<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>send_kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    489</span> 
<span class="ansi-green-intense-fg ansi-bold">    490</span>         <span class="ansi-green-intense-fg ansi-bold">return</span> resp

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    607</span> 
<span class="ansi-green-intense-fg ansi-bold">    608</span>         <span class="ansi-red-intense-fg ansi-bold"># Send the request</span>
<span class="ansi-green-fg">--&gt; 609</span><span class="ansi-red-fg">         </span>r <span class="ansi-yellow-intense-fg ansi-bold">=</span> adapter<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>request<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    610</span> 
<span class="ansi-green-intense-fg ansi-bold">    611</span>         <span class="ansi-red-intense-fg ansi-bold"># Total elapsed time of the request (approximately)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    485</span>                 <span class="ansi-green-intense-fg ansi-bold">raise</span> ProxyError<span class="ansi-yellow-intense-fg ansi-bold">(</span>e<span class="ansi-yellow-intense-fg ansi-bold">,</span> request<span class="ansi-yellow-intense-fg ansi-bold">=</span>request<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    486</span> 
<span class="ansi-green-fg">--&gt; 487</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">raise</span> ConnectionError<span class="ansi-yellow-intense-fg ansi-bold">(</span>e<span class="ansi-yellow-intense-fg ansi-bold">,</span> request<span class="ansi-yellow-intense-fg ansi-bold">=</span>request<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    488</span> 
<span class="ansi-green-intense-fg ansi-bold">    489</span>         <span class="ansi-green-intense-fg ansi-bold">except</span> ClosedPoolError <span class="ansi-green-intense-fg ansi-bold">as</span> e<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-red-fg">ConnectionError</span>: HTTPConnectionPool(host=&#39;ichart.finance.yahoo.com&#39;, port=80): Max retries exceeded with url: /table.csv?s=SPY&amp;a=0&amp;b=1&amp;c=2010&amp;d=6&amp;e=24&amp;f=2017&amp;g=d&amp;ignore=.csv (Caused by NewConnectionError(&#39;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5E5550&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed&#39;,))</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 放入两份标普500指数合约及其到期日</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="n">expiry</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ESU2&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
          <span class="s1">&#39;ESZ2&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">)}</span>
<span class="n">expiry</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">expiry</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\ProgramData\Anaconda3\lib\site-packages\ipykernel\__main__.py:5: FutureWarning: order is deprecated, use sort_values(...)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expiry</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt output_prompt">Out[23]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>ESU2   2012-09-21
ESZ2   2012-12-21
dtype: datetime64[ns]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 用 雅虎的价格及随机漫步噪声模拟未来走势</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12347</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">walk</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span>
<span class="n">perturb</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span>
<span class="n">walk</span> <span class="o">=</span> <span class="n">walk</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">px</span><span class="p">)</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
<span class="n">near</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">px</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">px</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">walk</span><span class="p">])</span>
<span class="n">far</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">px</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">px</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">walk</span> <span class="o">+</span> <span class="n">perturb</span><span class="p">])</span>
<span class="n">prices</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ESU2&#39;</span><span class="p">:</span> <span class="n">near</span><span class="p">,</span> <span class="s1">&#39;ESZ2&#39;</span><span class="p">:</span> <span class="n">far</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-25-0a4a98036b40&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-intense-fg ansi-bold">      8</span> rng <span class="ansi-yellow-intense-fg ansi-bold">=</span> pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>date_range<span class="ansi-yellow-intense-fg ansi-bold">(</span>px<span class="ansi-yellow-intense-fg ansi-bold">.</span>index<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> periods<span class="ansi-yellow-intense-fg ansi-bold">=</span>len<span class="ansi-yellow-intense-fg ansi-bold">(</span>px<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">+</span> N<span class="ansi-yellow-intense-fg ansi-bold">,</span> freq<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;B&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg"> </span>near <span class="ansi-yellow-intense-fg ansi-bold">=</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>concatenate<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">[</span>px<span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">,</span> px<span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">-</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">+</span> walk<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span> far <span class="ansi-yellow-intense-fg ansi-bold">=</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>concatenate<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">[</span>px<span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">,</span> px<span class="ansi-yellow-intense-fg ansi-bold">.</span>values<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">-</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">+</span> walk <span class="ansi-yellow-intense-fg ansi-bold">+</span> perturb<span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span> prices <span class="ansi-yellow-intense-fg ansi-bold">=</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">{</span><span class="ansi-blue-intense-fg ansi-bold">&#39;ESU2&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span> near<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;ESZ2&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span> far<span class="ansi-yellow-intense-fg ansi-bold">}</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> index<span class="ansi-yellow-intense-fg ansi-bold">=</span>rng<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">ValueError</span>: operands could not be broadcast together with shapes (10,) (200,) </pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># prices: 关于这两个合约的时间序列</span>
<span class="n">prices</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-26-84d92c9aa1f0&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># prices: 关于这两个合约的时间序列</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>prices<span class="ansi-yellow-intense-fg ansi-bold">.</span>tail<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;prices&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 将多个时间序列合并为单个连续序列。方法：构造一个加权矩阵。</span>
<span class="c1"># 其中活动合约的权重为1， 直到期满为止。</span>
<span class="c1"># 下面的函数计算加权矩阵，权重根据到期前的期数减少而线性衰减</span>

<span class="k">def</span> <span class="nf">get_roll_weights</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">expiry</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">roll_periods</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># start : first date to compute weighting DataFrame</span>
    <span class="c1"># expiry : Series of ticker -&gt; expiration dates</span>
    <span class="c1"># items : sequence of contract names</span>

    <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">expiry</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">))),</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>

    <span class="n">prev_date</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ex_date</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expiry</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">expiry</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">prev_date</span><span class="p">:</span><span class="n">ex_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">(),</span> <span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">roll_rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">ex_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">(),</span>
                                     <span class="n">periods</span><span class="o">=</span><span class="n">roll_periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>

            <span class="n">decay_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">roll_periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">roll_rng</span><span class="p">,</span> <span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">decay_weights</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">roll_rng</span><span class="p">,</span> <span class="n">expiry</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">decay_weights</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">prev_date</span><span class="p">:,</span> <span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">prev_date</span> <span class="o">=</span> <span class="n">ex_date</span>

    <span class="k">return</span> <span class="n">weights</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 权重计算结果</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">get_roll_weights</span><span class="p">(</span><span class="s1">&#39;6/1/2012&#39;</span><span class="p">,</span> <span class="n">expiry</span><span class="p">,</span> <span class="n">prices</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">weights</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="s1">&#39;2012-09-12&#39;</span><span class="p">:</span><span class="s1">&#39;2012-09-21&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-28-2841b6423261&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 权重计算结果</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>weights <span class="ansi-yellow-intense-fg ansi-bold">=</span> get_roll_weights<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;6/1/2012&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> expiry<span class="ansi-yellow-intense-fg ansi-bold">,</span> prices<span class="ansi-yellow-intense-fg ansi-bold">.</span>columns<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> weights<span class="ansi-yellow-intense-fg ansi-bold">.</span>ix<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;2012-09-12&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span><span class="ansi-blue-intense-fg ansi-bold">&#39;2012-09-21&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>

<span class="ansi-red-fg">NameError</span>: name &#39;prices&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 转仓收益就是合约收益的加权和</span>
<span class="n">rolled_returns</span> <span class="o">=</span> <span class="p">(</span><span class="n">prices</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-29-f255425d54ca&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 转仓收益就是合约收益的加权和</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>rolled_returns <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span>prices<span class="ansi-yellow-intense-fg ansi-bold">.</span>pct_change<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">*</span> weights<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>sum<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;prices&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#31227;&#21160;&#30456;&#20851;&#31995;&#25968;&#19982;&#32447;&#24615;&#22238;&#24402;">&#31227;&#21160;&#30456;&#20851;&#31995;&#25968;&#19982;&#32447;&#24615;&#22238;&#24402;<a class="anchor-link" href="#&#31227;&#21160;&#30456;&#20851;&#31995;&#25968;&#19982;&#32447;&#24615;&#22238;&#24402;">&#182;</a></h2><p>动态模型，可用于模拟历史时期中的交易决策。</p>
<p>移动窗口和指数加权时间序列函数是用于处理动态模型的工具。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 相关系数是观察两个资产时间序列变化的协动性的一种手段。</span>
<span class="c1"># pandas 的 rolling_corr函数可以根据两个收益序列，计算出移动窗口的相关系数</span>

<span class="c1"># 加载价格序列并计算每日收益率</span>
<span class="n">aapl</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">)[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>
<span class="n">msft</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">get_data_yahoo</span><span class="p">(</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">)[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>

<span class="n">aapl_rets</span> <span class="o">=</span> <span class="n">aapl</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="n">msft_rets</span> <span class="o">=</span> <span class="n">msft</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">gaierror</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">_new_conn</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>             conn = connection.create_connection(
<span class="ansi-green-fg">--&gt; 138</span><span class="ansi-red-fg">                 (self.host, self.port), self.timeout, **extra_kw)
</span><span class="ansi-green-intense-fg ansi-bold">    139</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\util\connection.py</span> in <span class="ansi-cyan-fg">create_connection</span><span class="ansi-blue-fg">(address, timeout, source_address, socket_options)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 
<span class="ansi-green-fg">---&gt; 75</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">for</span> res <span class="ansi-green-intense-fg ansi-bold">in</span> socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>getaddrinfo<span class="ansi-yellow-intense-fg ansi-bold">(</span>host<span class="ansi-yellow-intense-fg ansi-bold">,</span> port<span class="ansi-yellow-intense-fg ansi-bold">,</span> family<span class="ansi-yellow-intense-fg ansi-bold">,</span> socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>SOCK_STREAM<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         af<span class="ansi-yellow-intense-fg ansi-bold">,</span> socktype<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> canonname<span class="ansi-yellow-intense-fg ansi-bold">,</span> sa <span class="ansi-yellow-intense-fg ansi-bold">=</span> res

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\socket.py</span> in <span class="ansi-cyan-fg">getaddrinfo</span><span class="ansi-blue-fg">(host, port, family, type, proto, flags)</span>
<span class="ansi-green-intense-fg ansi-bold">    742</span>     addrlist <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">--&gt; 743</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">for</span> res <span class="ansi-green-intense-fg ansi-bold">in</span> _socket<span class="ansi-yellow-intense-fg ansi-bold">.</span>getaddrinfo<span class="ansi-yellow-intense-fg ansi-bold">(</span>host<span class="ansi-yellow-intense-fg ansi-bold">,</span> port<span class="ansi-yellow-intense-fg ansi-bold">,</span> family<span class="ansi-yellow-intense-fg ansi-bold">,</span> type<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> flags<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    744</span>         af<span class="ansi-yellow-intense-fg ansi-bold">,</span> socktype<span class="ansi-yellow-intense-fg ansi-bold">,</span> proto<span class="ansi-yellow-intense-fg ansi-bold">,</span> canonname<span class="ansi-yellow-intense-fg ansi-bold">,</span> sa <span class="ansi-yellow-intense-fg ansi-bold">=</span> res

<span class="ansi-red-fg">gaierror</span>: [Errno 11004] getaddrinfo failed

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">NewConnectionError</span>                        Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    593</span>                                                   body<span class="ansi-yellow-intense-fg ansi-bold">=</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> headers<span class="ansi-yellow-intense-fg ansi-bold">=</span>headers<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 594</span><span class="ansi-red-fg">                                                   chunked=chunked)
</span><span class="ansi-green-intense-fg ansi-bold">    595</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    360</span>         <span class="ansi-green-intense-fg ansi-bold">else</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 361</span><span class="ansi-red-fg">             </span>conn<span class="ansi-yellow-intense-fg ansi-bold">.</span>request<span class="ansi-yellow-intense-fg ansi-bold">(</span>method<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>httplib_request_kw<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    362</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, body, headers, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1238</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34;Send a complete request to the server.&#34;&#34;&#34;</span>
<span class="ansi-green-fg">-&gt; 1239</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_send_request<span class="ansi-yellow-intense-fg ansi-bold">(</span>method<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> body<span class="ansi-yellow-intense-fg ansi-bold">,</span> headers<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1240</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">_send_request</span><span class="ansi-blue-fg">(self, method, url, body, headers, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1284</span>             body <span class="ansi-yellow-intense-fg ansi-bold">=</span> _encode<span class="ansi-yellow-intense-fg ansi-bold">(</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;body&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">-&gt; 1285</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>endheaders<span class="ansi-yellow-intense-fg ansi-bold">(</span>body<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">=</span>encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1286</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">endheaders</span><span class="ansi-blue-fg">(self, message_body, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1233</span>             <span class="ansi-green-intense-fg ansi-bold">raise</span> CannotSendHeader<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">-&gt; 1234</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_send_output<span class="ansi-yellow-intense-fg ansi-bold">(</span>message_body<span class="ansi-yellow-intense-fg ansi-bold">,</span> encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">=</span>encode_chunked<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1235</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">_send_output</span><span class="ansi-blue-fg">(self, message_body, encode_chunked)</span>
<span class="ansi-green-intense-fg ansi-bold">   1025</span>         <span class="ansi-green-intense-fg ansi-bold">del</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_buffer<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-yellow-intense-fg ansi-bold">:</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">-&gt; 1026</span><span class="ansi-red-fg">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>msg<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1027</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\http\client.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, data)</span>
<span class="ansi-green-intense-fg ansi-bold">    963</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>auto_open<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 964</span><span class="ansi-red-fg">                 </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>connect<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    965</span>             <span class="ansi-green-intense-fg ansi-bold">else</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">connect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    162</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> connect<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 163</span><span class="ansi-red-fg">         </span>conn <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_new_conn<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    164</span>         self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_prepare_conn<span class="ansi-yellow-intense-fg ansi-bold">(</span>conn<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connection.py</span> in <span class="ansi-cyan-fg">_new_conn</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    146</span>             raise NewConnectionError(
<span class="ansi-green-fg">--&gt; 147</span><span class="ansi-red-fg">                 self, &#34;Failed to establish a new connection: %s&#34; % e)
</span><span class="ansi-green-intense-fg ansi-bold">    148</span> 

<span class="ansi-red-fg">NewConnectionError</span>: &lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5A6E80&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">MaxRetryError</span>                             Traceback (most recent call last)
<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    422</span>                     retries<span class="ansi-yellow-intense-fg ansi-bold">=</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>max_retries<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">--&gt; 423</span><span class="ansi-red-fg">                     </span>timeout<span class="ansi-yellow-intense-fg ansi-bold">=</span>timeout
<span class="ansi-green-intense-fg ansi-bold">    424</span>                 )

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    642</span>             retries = retries.increment(method, url, error=e, _pool=self,
<span class="ansi-green-fg">--&gt; 643</span><span class="ansi-red-fg">                                         _stacktrace=sys.exc_info()[2])
</span><span class="ansi-green-intense-fg ansi-bold">    644</span>             retries<span class="ansi-yellow-intense-fg ansi-bold">.</span>sleep<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\packages\urllib3\util\retry.py</span> in <span class="ansi-cyan-fg">increment</span><span class="ansi-blue-fg">(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="ansi-green-intense-fg ansi-bold">    362</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> new_retry<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_exhausted<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 363</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">raise</span> MaxRetryError<span class="ansi-yellow-intense-fg ansi-bold">(</span>_pool<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> error <span class="ansi-green-intense-fg ansi-bold">or</span> ResponseError<span class="ansi-yellow-intense-fg ansi-bold">(</span>cause<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    364</span> 

<span class="ansi-red-fg">MaxRetryError</span>: HTTPConnectionPool(host=&#39;ichart.finance.yahoo.com&#39;, port=80): Max retries exceeded with url: /table.csv?s=AAPL&amp;a=0&amp;b=1&amp;c=2000&amp;d=6&amp;e=24&amp;f=2017&amp;g=d&amp;ignore=.csv (Caused by NewConnectionError(&#39;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5A6E80&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed&#39;,))

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ConnectionError</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-30-4db3157b9e89&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> 
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-red-intense-fg ansi-bold"># 加载价格序列并计算每日收益率</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg"> </span>aapl <span class="ansi-yellow-intense-fg ansi-bold">=</span> web<span class="ansi-yellow-intense-fg ansi-bold">.</span>get_data_yahoo<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;AAPL&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;2000-01-01&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> msft <span class="ansi-yellow-intense-fg ansi-bold">=</span> web<span class="ansi-yellow-intense-fg ansi-bold">.</span>get_data_yahoo<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;MSFT&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;2000-01-01&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\data.py</span> in <span class="ansi-cyan-fg">get_data_yahoo</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span> 
<span class="ansi-green-intense-fg ansi-bold">     39</span> <span class="ansi-green-intense-fg ansi-bold">def</span> get_data_yahoo<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">*</span>args<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">---&gt; 40</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">return</span> YahooDailyReader<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">*</span>args<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>read<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     41</span> 
<span class="ansi-green-intense-fg ansi-bold">     42</span> 

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\yahoo\daily.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> read<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34; read one data from specified URL &#34;&#34;&#34;</span>
<span class="ansi-green-fg">---&gt; 77</span><span class="ansi-red-fg">         </span>df <span class="ansi-yellow-intense-fg ansi-bold">=</span> super<span class="ansi-yellow-intense-fg ansi-bold">(</span>YahooDailyReader<span class="ansi-yellow-intense-fg ansi-bold">,</span> self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>read<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>ret_index<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>             df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Ret_Index&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> _calc_return_index<span class="ansi-yellow-intense-fg ansi-bold">(</span>df<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Adj Close&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    155</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>symbols<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span>compat<span class="ansi-yellow-intense-fg ansi-bold">.</span>string_types<span class="ansi-yellow-intense-fg ansi-bold">,</span> int<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>             df = self._read_one_data(self.url,
<span class="ansi-green-fg">--&gt; 157</span><span class="ansi-red-fg">                                      params=self._get_params(self.symbols))
</span><span class="ansi-green-intense-fg ansi-bold">    158</span>         <span class="ansi-red-intense-fg ansi-bold"># Or multiple symbols, (e.g., [&#39;GOOG&#39;, &#39;AAPL&#39;, &#39;MSFT&#39;])</span>
<span class="ansi-green-intense-fg ansi-bold">    159</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>symbols<span class="ansi-yellow-intense-fg ansi-bold">,</span> DataFrame<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_read_one_data</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     72</span>         <span class="ansi-blue-intense-fg ansi-bold">&#34;&#34;&#34; read one data from specified URL &#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_format <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;string&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">---&gt; 74</span><span class="ansi-red-fg">             </span>out <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_read_url_as_StringIO<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>         <span class="ansi-green-intense-fg ansi-bold">elif</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_format <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;json&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>             out <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_get_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>json<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_read_url_as_StringIO</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>         Open url <span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-green-intense-fg ansi-bold">and</span> retry<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">---&gt; 85</span><span class="ansi-red-fg">         </span>response <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_get_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     86</span>         text <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_sanitize_response<span class="ansi-yellow-intense-fg ansi-bold">(</span>response<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">     87</span>         out <span class="ansi-yellow-intense-fg ansi-bold">=</span> StringIO<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\pandas_datareader\base.py</span> in <span class="ansi-cyan-fg">_get_response</span><span class="ansi-blue-fg">(self, url, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    112</span>         <span class="ansi-red-intense-fg ansi-bold"># initial attempt + retry</span>
<span class="ansi-green-intense-fg ansi-bold">    113</span>         <span class="ansi-green-intense-fg ansi-bold">for</span> i <span class="ansi-green-intense-fg ansi-bold">in</span> range<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>retry_count <span class="ansi-yellow-intense-fg ansi-bold">+</span> <span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">--&gt; 114</span><span class="ansi-red-fg">             </span>response <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>session<span class="ansi-yellow-intense-fg ansi-bold">.</span>get<span class="ansi-yellow-intense-fg ansi-bold">(</span>url<span class="ansi-yellow-intense-fg ansi-bold">,</span> params<span class="ansi-yellow-intense-fg ansi-bold">=</span>params<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> response<span class="ansi-yellow-intense-fg ansi-bold">.</span>status_code <span class="ansi-yellow-intense-fg ansi-bold">==</span> requests<span class="ansi-yellow-intense-fg ansi-bold">.</span>codes<span class="ansi-yellow-intense-fg ansi-bold">.</span>ok<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>                 <span class="ansi-green-intense-fg ansi-bold">return</span> response

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(self, url, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    499</span> 
<span class="ansi-green-intense-fg ansi-bold">    500</span>         kwargs<span class="ansi-yellow-intense-fg ansi-bold">.</span>setdefault<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;allow_redirects&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-green-intense-fg ansi-bold">True</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">--&gt; 501</span><span class="ansi-red-fg">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>request<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;GET&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    502</span> 
<span class="ansi-green-intense-fg ansi-bold">    503</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> options<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> url<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="ansi-green-intense-fg ansi-bold">    486</span>         }
<span class="ansi-green-intense-fg ansi-bold">    487</span>         send_kwargs<span class="ansi-yellow-intense-fg ansi-bold">.</span>update<span class="ansi-yellow-intense-fg ansi-bold">(</span>settings<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">--&gt; 488</span><span class="ansi-red-fg">         </span>resp <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>prep<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>send_kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    489</span> 
<span class="ansi-green-intense-fg ansi-bold">    490</span>         <span class="ansi-green-intense-fg ansi-bold">return</span> resp

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\sessions.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    607</span> 
<span class="ansi-green-intense-fg ansi-bold">    608</span>         <span class="ansi-red-intense-fg ansi-bold"># Send the request</span>
<span class="ansi-green-fg">--&gt; 609</span><span class="ansi-red-fg">         </span>r <span class="ansi-yellow-intense-fg ansi-bold">=</span> adapter<span class="ansi-yellow-intense-fg ansi-bold">.</span>send<span class="ansi-yellow-intense-fg ansi-bold">(</span>request<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    610</span> 
<span class="ansi-green-intense-fg ansi-bold">    611</span>         <span class="ansi-red-intense-fg ansi-bold"># Total elapsed time of the request (approximately)</span>

<span class="ansi-green-fg">C:\ProgramData\Anaconda3\lib\site-packages\requests\adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    485</span>                 <span class="ansi-green-intense-fg ansi-bold">raise</span> ProxyError<span class="ansi-yellow-intense-fg ansi-bold">(</span>e<span class="ansi-yellow-intense-fg ansi-bold">,</span> request<span class="ansi-yellow-intense-fg ansi-bold">=</span>request<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    486</span> 
<span class="ansi-green-fg">--&gt; 487</span><span class="ansi-red-fg">             </span><span class="ansi-green-intense-fg ansi-bold">raise</span> ConnectionError<span class="ansi-yellow-intense-fg ansi-bold">(</span>e<span class="ansi-yellow-intense-fg ansi-bold">,</span> request<span class="ansi-yellow-intense-fg ansi-bold">=</span>request<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">    488</span> 
<span class="ansi-green-intense-fg ansi-bold">    489</span>         <span class="ansi-green-intense-fg ansi-bold">except</span> ClosedPoolError <span class="ansi-green-intense-fg ansi-bold">as</span> e<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-red-fg">ConnectionError</span>: HTTPConnectionPool(host=&#39;ichart.finance.yahoo.com&#39;, port=80): Max retries exceeded with url: /table.csv?s=AAPL&amp;a=0&amp;b=1&amp;c=2000&amp;d=6&amp;e=24&amp;f=2017&amp;g=d&amp;ignore=.csv (Caused by NewConnectionError(&#39;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x000000000B5A6E80&gt;: Failed to establish a new connection: [Errno 11004] getaddrinfo failed&#39;,))</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 计算一年期移动相关系数并绘制图表</span>
<span class="n">pd</span><span class="o">.</span><span class="n">rolling_corr</span><span class="p">(</span><span class="n">aapl_rets</span><span class="p">,</span> <span class="n">msft_rets</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-31-0853087e59d3&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 计算一年期移动相关系数并绘制图表</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>rolling_corr<span class="ansi-yellow-intense-fg ansi-bold">(</span>aapl_rets<span class="ansi-yellow-intense-fg ansi-bold">,</span> msft_rets<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">250</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>plot<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> plt<span class="ansi-yellow-intense-fg ansi-bold">.</span>figure<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;aapl_rets&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 两个资产直接的相关系数不能捕获波动性差异。</span>
<span class="c1"># 最小二乘回归，提供了一个变量与一个或多个其他预测变量之间动态关系的建模办法</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">aapl_rets</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;MSFT&#39;</span><span class="p">:</span> <span class="n">msft_rets</span><span class="p">},</span> <span class="n">window</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">beta</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-32-d9ef4ad8be80&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-intense-fg ansi-bold"># 两个资产直接的相关系数不能捕获波动性差异。</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-red-intense-fg ansi-bold"># 最小二乘回归，提供了一个变量与一个或多个其他预测变量之间动态关系的建模办法</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>model <span class="ansi-yellow-intense-fg ansi-bold">=</span> pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>ols<span class="ansi-yellow-intense-fg ansi-bold">(</span>y<span class="ansi-yellow-intense-fg ansi-bold">=</span>aapl_rets<span class="ansi-yellow-intense-fg ansi-bold">,</span> x<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-yellow-intense-fg ansi-bold">{</span><span class="ansi-blue-intense-fg ansi-bold">&#39;MSFT&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">:</span> msft_rets<span class="ansi-yellow-intense-fg ansi-bold">}</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> window<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">250</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> model<span class="ansi-yellow-intense-fg ansi-bold">.</span>beta

<span class="ansi-red-fg">NameError</span>: name &#39;aapl_rets&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-33-3518a6dfbdb1&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>model<span class="ansi-yellow-intense-fg ansi-bold">.</span>beta<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;MSFT&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>plot<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;model&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>
</div>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/读书笔记/" rel="tag"># 读书笔记</a>
          
            <a href="/tags/python/" rel="tag"># python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/20/python_data_analysis10/index.html" rel="next" title="利用Python进行数据分析(10)：时间序列">
                <i class="fa fa-chevron-left"></i> 利用Python进行数据分析(10)：时间序列
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/24/python_data_analysis12/index.html" rel="prev" title="利用Python进行数据分析(12)：NumPy高级应用">
                利用Python进行数据分析(12)：NumPy高级应用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="vcomments"></div>
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Holbrook</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">115</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/holbrook" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:wanghaikuo@tsinghua.org.cn" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.douban.com/people/168633248/" target="_blank" title="豆瓣">
                    
                      <i class="fa fa-fw fa-douban"></i></a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#数据规整化方面的话题"><span class="nav-number">1.</span> <span class="nav-text">数据规整化方面的话题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#时间序列以及截面对齐"><span class="nav-number">1.1.</span> <span class="nav-text">时间序列以及截面对齐¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#频率不同的时间按序列的运算"><span class="nav-number">1.2.</span> <span class="nav-text">频率不同的时间按序列的运算¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-Period"><span class="nav-number">1.2.1.</span> <span class="nav-text">使用 Period¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时间和“最当前”数据选取"><span class="nav-number">1.2.2.</span> <span class="nav-text">时间和“最当前”数据选取¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拼接多个数据源"><span class="nav-number">1.3.</span> <span class="nav-text">拼接多个数据源¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#收益指数和累计收益"><span class="nav-number">1.4.</span> <span class="nav-text">收益指数和累计收益¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#分组变换和分析"><span class="nav-number">2.</span> <span class="nav-text">分组变换和分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#分组因子暴露"><span class="nav-number">2.1.</span> <span class="nav-text">分组因子暴露¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十分位和四分位分析"><span class="nav-number">2.2.</span> <span class="nav-text">十分位和四分位分析¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#更多示例应用"><span class="nav-number">3.</span> <span class="nav-text">更多示例应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#信号前沿分析"><span class="nav-number">3.1.</span> <span class="nav-text">信号前沿分析¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#期货合约转仓"><span class="nav-number">3.2.</span> <span class="nav-text">期货合约转仓¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#移动相关系数与线性回归"><span class="nav-number">3.3.</span> <span class="nav-text">移动相关系数与线性回归¶</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Holbrook</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  










  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7-rc3/dist/Valine.min.js"></script>
  <script type="text/javascript">
    new Valine({
        av: AV,
        el: '#comments' ,
        verify: false,
        notify: false,
        app_id: 'zUfVbs5n4oyicDn3XvALUDTT-gzGzoHsz',
        app_key: '0jvfoj6veWsDfOsYNd976DMC',
        placeholder: 'Comment input placeholder'
    });
  </script>



  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.3"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("zUfVbs5n4oyicDn3XvALUDTT-gzGzoHsz", "0jvfoj6veWsDfOsYNd976DMC");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
